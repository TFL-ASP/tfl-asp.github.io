<!DOCTYPE html>
<html lang="en-us">
    <head><meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'><meta name='description' content='SSD核心技术剖析'><title>年度巨献 | 深入浅出SSD（持续更新）</title>

<link rel='canonical' href='https://tflasp.fun/2024/intossd/'>

<link rel="stylesheet" href="/scss/style.min.46208cabd58e8bcef0cfb7d7ea6b561adcca3b91dd1fc6657493a44f03c5db75.css"><meta property='og:title' content='年度巨献 | 深入浅出SSD（持续更新）'>
<meta property='og:description' content='SSD核心技术剖析'>
<meta property='og:url' content='https://tflasp.fun/2024/intossd/'>
<meta property='og:site_name' content='改BUG的大橘'>
<meta property='og:type' content='article'><meta property='article:section' content='Post' /><meta property='article:tag' content='SSD' /><meta property='article:published_time' content='2024-08-04T00:00:00&#43;00:00'/><meta property='article:modified_time' content='2024-08-04T00:00:00&#43;00:00'/><meta property='og:image' content='https://tflasp.fun/2024/intossd/ssd.jpg' />
<meta name="twitter:title" content="年度巨献 | 深入浅出SSD（持续更新）">
<meta name="twitter:description" content="SSD核心技术剖析"><meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content='https://tflasp.fun/2024/intossd/ssd.jpg' />

<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
  <meta name="referrer" content="no-referrer-when-downgrade">
  

<style>
    :root {
        --article-font-family: "Noto Serif SC", var(--base-font-family);
    }
</style>

<script> 
		(function () {
		    const customFont = document.createElement('link');
		    customFont.href = "https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@300;700&display=swap"; 
		    customFont.type = "text/css";
		    customFont.rel = "stylesheet";
		
		    document.head.appendChild(customFont);
		}());
</script>

    </head>
    <body class="
    article-page
">
    <script>
        (function() {
            const colorSchemeKey = 'StackColorScheme';
            if(!localStorage.getItem(colorSchemeKey)){
                localStorage.setItem(colorSchemeKey, "dark");
            }
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'StackColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.documentElement.dataset.scheme = 'dark';
        } else {
            document.documentElement.dataset.scheme = 'light';
        }
    })();
</script>
<div class="container main-container flex 
    <!-- 
        extended
     -->
    on-phone--column extended
">
    
<div id="article-toolbar">
    <a href="https://tflasp.fun/" class="back-home">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-chevron-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <polyline points="15 6 9 12 15 18" />
</svg>



        <span>返回</span>
    </a>
</div>
    <aside class="sidebar left-sidebar sticky">
    <button class="hamburger hamburger--spin" type="button" id="toggle-menu" aria-label="切换菜单">
        <span class="hamburger-box">
            <span class="hamburger-inner"></span>
        </span>
    </button>

    <header class="site-info">
        
            
            <figure class="site-avatar">
                <a href="/">
                
                    
                    
                    
                        
                        <img src="/img/avatar_hu4b2414d569d16040044da8ad8587484d_26765_300x0_resize_box_3.png" width="300"
                            height="300" class="site-logo" loading="lazy" alt="Avatar">
                    
                
                </a>
                
                    <span class="emoji">💬</span>
                
            </figure>
            
        
        
        <h1 class="site-name"><a href="/">改BUG的大橘</a></h1>
        <h2 class="site-description">要找的，近在眼前</h2><ol class="social-menu">
                
                    <li>
                        <a 
                            href='https://space.bilibili.com/3494374367300353'
                            target="_blank"
                            title="Bilibili"
                        >
                            
                            
                                <svg  xmlns="http://www.w3.org/2000/svg"  width="24"  height="24"  viewBox="0 0 24 24"  fill="none"  stroke="currentColor"  stroke-width="2"  stroke-linecap="round"  stroke-linejoin="round"  class="icon icon-tabler icons-tabler-outline icon-tabler-brand-bilibili"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M3 10a4 4 0 0 1 4 -4h10a4 4 0 0 1 4 4v6a4 4 0 0 1 -4 4h-10a4 4 0 0 1 -4 -4v-6z" /><path d="M8 3l2 3" /><path d="M16 3l-2 3" /><path d="M9 13v-2" /><path d="M15 11v2" /></svg>
                            
                        </a>
                    </li>
                
                    <li>
                        <a 
                            href='https://blog.csdn.net/Dd_w606'
                            target="_blank"
                            title="CSDN"
                        >
                            
                            
                                <svg  xmlns="http://www.w3.org/2000/svg"  width="24"  height="24"  viewBox="0 0 24 24"  fill="none"  stroke="currentColor"  stroke-width="2"  stroke-linecap="round"  stroke-linejoin="round"  class="icon icon-tabler icons-tabler-outline icon-tabler-code"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M7 8l-4 4l4 4" /><path d="M17 8l4 4l-4 4" /><path d="M14 4l-4 16" /></svg>
                            
                        </a>
                    </li>
                
                    <li>
                        <a 
                            href='https://tflasp.fun/2024/links/'
                            target="_blank"
                            title="FileShare"
                        >
                            
                            
                                <svg  xmlns="http://www.w3.org/2000/svg"  width="24"  height="24"  viewBox="0 0 24 24"  fill="none"  stroke="currentColor"  stroke-width="2"  stroke-linecap="round"  stroke-linejoin="round"  class="icon icon-tabler icons-tabler-outline icon-tabler-file-zip"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M6 20.735a2 2 0 0 1 -1 -1.735v-14a2 2 0 0 1 2 -2h7l5 5v11a2 2 0 0 1 -2 2h-1" /><path d="M11 17a2 2 0 0 1 2 2v2a1 1 0 0 1 -1 1h-2a1 1 0 0 1 -1 -1v-2a2 2 0 0 1 2 -2z" /><path d="M11 5l-1 0" /><path d="M13 7l-1 0" /><path d="M11 9l-1 0" /><path d="M13 11l-1 0" /><path d="M11 13l-1 0" /><path d="M13 15l-1 0" /></svg>
                            
                        </a>
                    </li>
                
                    <li>
                        <a 
                            href='https://github.com/TFL-ASP'
                            target="_blank"
                            title="GitHub"
                        >
                            
                            
                                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5" />
</svg>



                            
                        </a>
                    </li>
                
                    <li>
                        <a 
                            href='https://qm.qq.com/q/z0wEdsiULK'
                            target="_blank"
                            title="QQ群"
                        >
                            
                            
                                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-messages" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M21 14l-3 -3h-7a1 1 0 0 1 -1 -1v-6a1 1 0 0 1 1 -1h9a1 1 0 0 1 1 1v10" />
  <path d="M14 15v2a1 1 0 0 1 -1 1h-7l-3 3v-10a1 1 0 0 1 1 -1h2" />
</svg>



                            
                        </a>
                    </li>
                
            </ol></header>

    <ol class="menu" id="main-menu">
        
        
        
        
        <li >
            <a href='/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <polyline points="5 12 3 12 12 3 21 12 19 12" />
  <path d="M5 12v7a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-7" />
  <path d="M9 21v-6a2 2 0 0 1 2 -2h2a2 2 0 0 1 2 2v6" />
</svg>



                
                <span>Home</span>
            </a>
        </li>
        
        
        
        <li >
            <a href='/about/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="7" r="4" />
  <path d="M6 21v-2a4 4 0 0 1 4 -4h4a4 4 0 0 1 4 4v2" />
</svg>



                
                <span>About</span>
            </a>
        </li>
        
        
        
        <li >
            <a href='/links/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <polyline points="5 12 3 12 12 3 21 12 19 12" />
  <path d="M5 12v7a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-7" />
  <path d="M9 21v-6a2 2 0 0 1 2 -2h2a2 2 0 0 1 2 2v6" />
</svg>



                
                <span>Links</span>
            </a>
        </li>
        
        
        
        <li >
            <a href='/archives/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <rect x="3" y="4" width="18" height="4" rx="2" />
  <path d="M5 8v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-10" />
  <line x1="10" y1="12" x2="14" y2="12" />
</svg>



                
                <span>Archives</span>
            </a>
        </li>
        
        
        
        <li >
            <a href='/search/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="10" cy="10" r="7" />
  <line x1="21" y1="21" x2="15" y2="15" />
</svg>



                
                <span>Search</span>
            </a>
        </li>
        

        
            <li id="dark-mode-toggle">
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="8" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="16" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                <span>暗色模式</span>
            </li>
        
    </ol>
</aside>

<main class="main full-width">
    <article class="has-image main-article">
    <header class="article-header">
        <div class="article-image">
            <a href="/2024/intossd/">
                <img src="/2024/intossd/ssd_hu9e606eafa84da1a4e5c2a51c6c293ee0_2842596_800x0_resize_q75_box.jpg"
                        srcset="/2024/intossd/ssd_hu9e606eafa84da1a4e5c2a51c6c293ee0_2842596_800x0_resize_q75_box.jpg 800w, /2024/intossd/ssd_hu9e606eafa84da1a4e5c2a51c6c293ee0_2842596_1600x0_resize_q75_box.jpg 1600w"
                        width="800" 
                        height="600" 
                        loading="lazy"
                        alt="Featured image of post 年度巨献 | 深入浅出SSD（持续更新）" />
                
            </a>
        </div>
    

    <div class="article-details">
    
    <header class="article-category">
        
            <a href="/categories/ssd/" >
                SSD
            </a>
        
            <a href="/categories/%E5%89%8D%E6%B2%BF%E6%8A%80%E6%9C%AF/" >
                前沿技术
            </a>
        
    </header>
    

    <h2 class="article-title">
        <a href="/2024/intossd/">年度巨献 | 深入浅出SSD（持续更新）</a>
    </h2>

    
    <h3 class="article-subtitle">
        SSD核心技术剖析
    </h3>
    

    
    <footer class="article-time">
        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M11.795 21h-6.795a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v4" />
  <circle cx="18" cy="18" r="4" />
  <path d="M15 3v4" />
  <path d="M7 3v4" />
  <path d="M3 11h16" />
  <path d="M18 16.496v1.504l1 1" />
</svg>
                <time class="article-time--published">Aug 04, 2024</time>
            </div>
        

        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <polyline points="12 7 12 12 15 15" />
</svg>



                <time class="article-words">
                    7761字
                </time>
            </div>
        
    </footer>
    
</div>
</header>

    <section class="article-content">
    
    
    <h2 id="ssd简介">SSD简介</h2>
<p>SSD (<code>Solid State Drive</code>)，即固态硬盘，是一种以半导体闪存(<code>NAND Flash</code>)作为介质的存储设备。和传统机械硬盘(<code>Hard Disk Drive，HDD</code>)不同，SSD以半导体存储数据，用纯电子电路实现，没有任何机械设备，这就决定了它在性能、功耗、可靠性等方面和HDD有很大不同。</p>
<h2 id="ssd-协议与接口">SSD 协议与接口</h2>
<h3 id="pcie协议">PCIe协议</h3>
<h4 id="pcie带宽">PCIe带宽</h4>
<p>PCIe GEN1在链路上的传输速率为2.5Gb/s。PCIe在GEN1和GEN2采用了8b/10b编码方式，也就是说链路上传输10b数据，实际传输的有效数据只有8b。对于GEN1 x1的PCIe链路，传输的有效带宽为：</p>
<pre><code>2.5Gb/s * 2 * 8b/10b * B/8b = 0.5GB/s
</code></pre>
<p>2代表TX和RX</p>
<p><figure 
	>
	<a href="https://img.picui.cn/free/2024/08/19/66c347b0dde5a.jpg" >
		<img src="https://img.picui.cn/free/2024/08/19/66c347b0dde5a.jpg"
			
			
			
			loading="lazy"
			>
	</a>
	
</figure></p>
<h4 id="pcie拓扑结构">PCIe拓扑结构</h4>
<p>PCIe主要的组件有RC（<code>Root Complex</code>），SW（<code>Switch</code>），EP（<code>Endpoint</code>）。RC可以和所有device进行通信，一个EP也可以和一个PCIe系统中的EP来通信（Peer-to-Peer）。协议规定SW需要支持Peer-to-Peer，但对于有多个port的RC并没有要求。也就是说下图中 PCIe4 和 PCIe5 可以进行数据通信，但 PCIe4 和 PCIe6 就不一定能进行数据传输。</p>
<p><code>RC</code>是指连接CPU和存储器子系统以及PCIe结构的设备，可以支持一个或多个PCIe Port，下图中RC支持3个PCIe Port，每个Port连接EP或者SW，SW形成一个子层，又可以挂接其他PCIe设备。</p>
<p>RC上的port可以进行数据交互，但协议并没有规定必须支持。</p>
<p><code>SW</code>是PCIe链路上进行转接的一类设备，拥有一个upstream prot和多个downstream port。可以将SW当作多个PCIe桥组成的设备。</p>
<p><code>EP</code>是PCIe链路的末端，有两种类型：Legacy Endpoint 和 PCIe Endpoint。传统EP支持IO事务，而且还需要能接收锁定事务。而PCIe EP不必支持IO事务和接收锁定事务，但必须支持MSI中断。</p>
<p><figure 
	>
	<a href="https://img.picui.cn/free/2024/08/19/66c347cf1e31e.jpg" >
		<img src="https://img.picui.cn/free/2024/08/19/66c347cf1e31e.jpg"
			
			
			
			loading="lazy"
			>
	</a>
	
</figure></p>
<pre><code>upstream port：在一个PCIe 设备上靠近RC方向的port。

downstream port：在一个PCIe 设别上远离RC方向的port。

Ingress port（入端口）：接收数据包的端口。

Egress port（出端口）：发送数据包的端口。
</code></pre>
<p>在一个PCIe系统中，<code>upstream port</code> 和 <code>downstream port</code>是固定的，但是<code>Ingress port</code> 和 <code>Egress port</code> 是不固定的，和数据包的传输方向相关。例如：图中RC发起 MWr 事务到PCI-XP 4，那么SW上的upstream就是<code>Ingress port</code>，downstream就是<code>Egress port</code>。而当PCI-XP4发起 MWr到 RC时，那么SW的downstream就是 <code>Ingress port</code>，upstream就是 <code>Egress port</code>。</p>
<h4 id="pcie-transaction">PCIe Transaction</h4>
<p>事务：Transaction指 requester 和 completer 之间完成一次信息传送时所需要完成的一系列或多个数据包传送的过程。</p>
<p>PCIe支持的事务类型与PCI、PCI-X支持的事务类型相同，包括存储器读和存储器写，IO读和IO写，配置读和配置写，此外还增加了一种新事务：消息（message）。</p>
<p>PCIe事务可以分为Non-Posted 和 Posted。Non-Posted指 requester 发送TLP请求包给completer时，completer需要返回一个TLP完成数据包给requester。Posted指requester 发送TLP请求事务包给 completer时，completer不需要回复TLP完成数据包给requester。</p>
<p><figure 
	>
	<a href="https://img.picui.cn/free/2024/08/19/66c348072b130.jpg" >
		<img src="https://img.picui.cn/free/2024/08/19/66c348072b130.jpg"
			
			
			
			loading="lazy"
			>
	</a>
	
</figure></p>
<p>PCIe的数据传输以数据包的形式进行传输，通信涉及一种称为处理层数据包（Transaction Layer packet， TLP）的数据包发送和接收。TLP包可以分为TLP请求的数据包和TLP完成的数据包。TLP请求的数据包依据PCIe事务的不同而不同，对于Non-Posted事务，需要completer 返回 TLP完成包给requester。TLP完成包带数据信息的称为CPLD，不带数据信息的称为CPL。</p>
<p><figure 
	>
	<a href="https://img.picui.cn/free/2024/08/19/66c3481fe8f17.jpg" >
		<img src="https://img.picui.cn/free/2024/08/19/66c3481fe8f17.jpg"
			
			
			
			loading="lazy"
			>
	</a>
	
</figure></p>
<p>更为具体的PCIe协议细节在此就不再赘述了，感兴趣可以在网上搜索更多技术细节</p>
<h3 id="nvme介绍">NVMe介绍</h3>
<h4 id="nvme综述">NVMe综述</h4>
<p>非易失性内存表达（<code>Non-Volatile Memory Express，NVMe</code>）是一种通过 PCI Express 接口访问非易失性存储设备（如固态硬盘）的技术。相较于使用 SATA 接口和 AHCI 标准的传统机械硬盘（HDD），NVMe 的数据访问速度获得了极大提升。NVMe 技术正是为了利用 PCI Express 的高带宽、低延迟等优势而开发的。以往 PCI Express 接口主要应用在显卡、声卡等扩展卡上，现在也应用到了高速存储接口上。</p>
<p>在 NVMe 驱动器面市之前，SSD 和 HDD 基本都使用 SATA 接口。但是，SATA 通信标准自身的性能瓶颈局限着 SSD 的发展空间，因此迫切需要一种新的接口标准。最初，开发者通过直接将 SSD 插在 PCI Express 插槽上来绕过这一瓶颈，但这种做法并不符合标准规范。</p>
<p>NVMe 为所有制造商提供了一个统一的标准。现在，大多数现代 NVMe SSD 都采用了 M.2 接口规格，而 M.2 接口有多种尺寸规格。</p>
<p><figure 
	>
	<a href="https://img.picui.cn/free/2024/08/19/66c3489952497.jpg" >
		<img src="https://img.picui.cn/free/2024/08/19/66c3489952497.jpg"
			
			
			
			loading="lazy"
			alt="M.2 B&M Key">
	</a>
	
	<figcaption>M.2 B&amp;M Key</figcaption>
	
</figure></p>
<p><figure 
	>
	<a href="https://img.picui.cn/free/2024/08/19/66c3486a08f38.jpg" >
		<img src="https://img.picui.cn/free/2024/08/19/66c3486a08f38.jpg"
			
			
			
			loading="lazy"
			>
	</a>
	
</figure></p>
<p>当然，除了消费级SSD,企业级SSD通常采用另一些接口来满足生产环境的需求，比如U.2、E1.S、E1.L、E3.S、E3.L等等规格。</p>
<p><figure 
	>
	<a href="https://img.picui.cn/free/2024/08/19/66c3487f5a606.jpg" >
		<img src="https://img.picui.cn/free/2024/08/19/66c3487f5a606.jpg"
			
			
			
			loading="lazy"
			>
	</a>
	
</figure></p>
<p>配套的还有主板上对应的接口，图中包含了U.2（SFF8639）、SATA以及eSATA接口。</p>
<p><figure 
	>
	<a href="https://img.picui.cn/free/2024/08/19/66c348a906f69.jpg" >
		<img src="https://img.picui.cn/free/2024/08/19/66c348a906f69.jpg"
			
			
			
			loading="lazy"
			>
	</a>
	
</figure></p>
<p>以下是一个不是很完全的总结：</p>
<p><figure 
	>
	<a href="https://img.picui.cn/free/2024/08/19/66c348c697b82.jpg" >
		<img src="https://img.picui.cn/free/2024/08/19/66c348c697b82.jpg"
			
			
			
			loading="lazy"
			>
	</a>
	
</figure></p>
<h2 id="ssd-主控与闪存">SSD 主控与闪存</h2>
<p>SATA SSD主控板实例：</p>
<p><figure 
	>
	<a href="https://img.picui.cn/free/2024/08/19/66c348e5a5c81.jpg" >
		<img src="https://img.picui.cn/free/2024/08/19/66c348e5a5c81.jpg"
			
			
			
			loading="lazy"
			>
	</a>
	
</figure></p>
<h3 id="主控概述">主控概述</h3>
<p><figure 
	>
	<a href="https://img.picui.cn/free/2024/08/19/66c348fa96c31.jpg" >
		<img src="https://img.picui.cn/free/2024/08/19/66c348fa96c31.jpg"
			
			
			
			loading="lazy"
			>
	</a>
	
</figure></p>
<h3 id="nand-flash概述">NAND Flash概述</h3>
<p>(该区域转载自<a class="link" href="https://news.skhynix.com.cn/flashback-the-evolution-of-nand-flash-technology/#:~:text=NAND%20%E9%97%AA%E5%AD%98%E6%98%AF%E4%B8%80%E7%A7%8D%E9%80%9A%E8%BF%87%E5%9C%A8%E6%B0%AE%E5%8C%96%E7%A1%85%E7%9A%84%E5%86%85%E9%83%A8%E8%A1%A5%E9%9B%86%E7%82%B9%E6%8D%95%E8%8E%B7%E7%94%B5%E5%AD%90%E6%88%96%E7%A9%BA%E7%A9%B4%E6%9D%A5%E5%AD%98%E5%82%A8%E4%BF%A1%E6%81%AF%E7%9A%84%E8%AE%BE%E5%A4%87%E3%80%82%20%E5%9C%A8%E8%BF%99%E7%A7%8D%E8%AE%BE%E5%A4%87%E4%B8%AD%EF%BC%8C%E5%B7%A5%E4%BD%9C%E5%8C%BA%E5%92%8C%E6%A0%85%E6%9E%81%E9%97%B4%E4%BC%9A%E7%95%99%E6%9C%89%E9%80%9A%E9%81%93%E4%BE%9B%E7%94%B5%E6%B5%81%E9%80%9A%E8%BF%87%E7%A1%85%E6%99%B6%E7%89%87%E8%A1%A8%E9%9D%A2%EF%BC%8C%E8%80%8C%E6%A0%B9%E6%8D%AE%E6%B5%AE%E7%BD%AE%E6%A0%85%E6%9E%81%E4%B8%AD%E5%AD%98%E5%82%A8%E7%9A%84%E7%94%B5%E8%8D%B7%E7%B1%BB%E5%9E%8B%EF%BC%8C%E4%BE%BF%E5%8F%AF%E8%BF%9B%E8%A1%8C%E5%AD%98%E5%82%A8%E7%BC%96%E7%A8%8B,%28%E2%80%9C1%E2%80%9D%29%20%E5%92%8C%E6%93%A6%E9%99%A4%20%28%E2%80%9C0%E2%80%9D%29%20%E4%BF%A1%E6%81%AF%E7%9A%84%E6%93%8D%E4%BD%9C%E3%80%82"  target="_blank" rel="noopener"
    >这里</a>)</p>
<p>NAND 闪存的数据存储方法</p>
<p>NAND 闪存是一种通过在氮化硅的内部补集点捕获电子或空穴来存储信息的设备。在这种设备中，工作区和栅极间会留有通道供电流通过硅晶片表面，而根据浮置栅极中存储的电荷类型，便可进行存储编程 (“1”) 和擦除 (“0”) 信息的操作。同时，在一个单元内存储 1 个比特的操作被称为单层单元 (SLC)。氮化硅内部捕获的电子数量与单元晶体管的阈值电压成正比，因此，当俘获大量电子时，即实现了高阈值电压；捕获少量电子会造成低阈值电压。</p>
<p>通过将捕获的电子数量分成三份，并将每份的中间电压施加到单元栅极上，可以检查电流的流通状态，从而确定所捕获的电子数量。在这种情况下，存在四种状态，其中包括擦除状态：这就是 2 比特多层单元 (<code>2 bit-MLC</code>)。2 比特多层单元的这四种状态可以描述为“11”、“10”、“01”和“00”，每个单元可以存储 2 个比特的信息。从定义而言，多层单元指的是一种状态，在这种状态下，一个单元具有多层的 2 个比特或更多比特；然而在本文中，多层单元是相对于单层单元（<code>SLC，Single Level Cell</code>）（ 而言的。方便起见，本文将存储 2 个比特信息的多层单元（<code>MLC，Multi Level Cell</code>）称为 2 比特多层单元。</p>
<p>在相同的方法下，若产生八单元状态并存储 3 个比特的信息时，此类状态则被称为三层单元 (<code>TLC，Triple Level Cell</code>)；同样，当产生十六单元状态并存储 4 个比特的信息时，则称为四层单元 (<code>QLC, Quadruple Level Cell</code>)。单元状态越密集，一个单元内便可储存更多信息。举例来说，与单层单元(SLC) NAND 闪存相比，四层单元(QLC) NAND 闪存能够以 67.5% 的芯片尺寸存储相同数量的信息；但若想进行更多运行和读取的操作，就要增大单元状态的密度。相应地，由于单元状态之间的空间狭窄，更大的密度会使性能降级并出现读取错误的可能性，从而导致设备寿命缩短。因此，重要的是，首先要根据NAND闪存的应用领域决定是否优先考虑信息量，性能和寿命，然后选择适当的编程方法。</p>
<p>3D/4D-NAND 与 NAND 闪存行业的发展趋势
当前，NAND 闪存正在从 2D 发展到 3D 和 4D。对于 2D-NAND，如果在同一区域实现更多的单元数量，形成更小的工作区和栅级，便能增大存储容量。直至 2010 年初，2D-NAND 中的扩展一直是这项技术的主要焦点所在；然而，由于精细图案结构的限制，且储存数据会随时间推移而丢失导致使用寿命缩短，该技术已无法再实现扩展。因此，3D-NAND逐渐取而代之，成为业界关注焦点，现在所有 NAND 制造商都在开发和制造 3D-NAND 产品。</p>
<p>在 3D-NAND 的结构中，存储容量会随着三维叠层中堆叠层数的增加而变大。3D-NAND 使用了堆叠多层氮氧化物的方法，形成一个被称为“塞子”的垂直深孔，在其中形成一个由氧化物-氮化物-氧化物制成的存储设备。通过这种方法，仅需少量工艺即可同时形成大量单元。在 3D-NAND 中，电流通过位于圆柱单元中心的多晶硅通道，便能根据存储在氮化硅中的电荷类型实现存储编程和擦除信息。虽然2D-NAND 技术发展的目标是实现形成较小的单元， 3D-NAND 的核心技术却是实现更多层数的三维堆叠。</p>
<p>近年来，为了在 3D-NAND 的基础上进一步增大存储容量，SK 海力士开发了 4D-NAND技术，使得芯片尺寸进一步缩小。4D-NAND 在 3D-NAND 单元下方形成外围电路，减少了外围电路所占的面积，从而实现存储容量的最大化并降低 NAND 闪存的成本。经过几代技术的发展，当前的半导体行业已实现了用更多层数存储更多信息，包括 SK 海力士在内的业界领先企业完成了多达 128 层的产品开发和投产准备，甚至正在研发更多层的产品设备。</p>
<h3 id="nand-flash-数据存储单元整体架构">NAND Flash 数据存储单元整体架构</h3>
<p><figure 
	>
	<a href="https://img.picui.cn/free/2024/08/19/66c3491786c62.jpg" >
		<img src="https://img.picui.cn/free/2024/08/19/66c3491786c62.jpg"
			
			
			
			loading="lazy"
			alt="NAND Flash 数据存储单元整体架构">
	</a>
	
	<figcaption>NAND Flash 数据存储单元整体架构</figcaption>
	
</figure></p>
<p><figure 
	>
	<a href="https://img.picui.cn/free/2024/08/19/66c3492d3557a.jpg" >
		<img src="https://img.picui.cn/free/2024/08/19/66c3492d3557a.jpg"
			
			
			
			loading="lazy"
			alt="NAND Flash 命名规则（部分）">
	</a>
	
	<figcaption>NAND Flash 命名规则（部分）</figcaption>
	
</figure></p>
<h3 id="nand-flash-封装">NAND Flash 封装</h3>
<p>随着目前产品小型化的需求越来越多，且可穿戴设备的逐渐普及，工程师们对于芯片小型化的需求也越来越强烈，这个就涉及到了芯片的封装工艺。这次，我们只针对NAND flash的封装进行介绍。</p>
<p>芯片常用封装有：DIP、QFP、PFP、PGA、BGA、TSOP、COB等封装。这里主要介绍NAND FLASH常用的三种封装（TSOP、BGA、COB）。</p>
<p>1、TSOP封装</p>
<p><figure 
	>
	<a href="https://img.picui.cn/free/2024/08/19/66c3493f71c79.jpg" >
		<img src="https://img.picui.cn/free/2024/08/19/66c3493f71c79.jpg"
			
			
			
			loading="lazy"
			>
	</a>
	
</figure></p>
<p>TSOP是“<code>Thin Small Outline Package</code>”的缩写，意思是薄型小尺寸封装。TSOP内存是在芯片的周围做出引脚，采用SMT技术（表面安装技术）附着在PCB板的表面，装配高度不到1.27mm。具体到FLASH这类型芯，工艺主要是把FLASH晶圆固定在钢板框架上，然后通过打线把晶圆上的点连接到框架的PIN脚上，再对表面进行注胶。</p>
<p>目前的最高的封闭技术能把四颗晶圆封闭在一个TSOP的FLASH内。此种TSOP封装的FLASH相对较厚。TSOP特点：电流大幅度变化时，引起输出电压较小，适合高频应用，操作比较方便（如方便手工贴片或拆片及反复利用），可靠性也比较高。同时TSOP封装具有成品率高。价格相对COB高，因此得到了极为广泛的应用。</p>
<p>2、COB封装</p>
<p>COB(chip on board) 板上芯片封装，是裸芯片贴装技术之一。半导体芯片交接贴装在印刷线路板上，芯片与PCB板是通过邦定连接的方法实现。NAND FLASH行业使用COB的封装方式主要是节省成本考虑。工程师先把外围电气走线画好，然后在PCB板上点红胶，把晶圆按指定方向及位置贴好。</p>
<p>然后使用邦定机对晶圆进行邦定。确认邦定电气性能良好后，对晶圆表面及PCB板部分进行树脂覆盖固定。COB 是最简单的裸芯片贴装技术，但它的封装密度远不如TSOP和BGA技术。</p>
<p>3、BGA封装</p>
<p><figure 
	>
	<a href="https://img.picui.cn/free/2024/08/19/66c34726f0bb5.jpg" >
		<img src="https://img.picui.cn/free/2024/08/19/66c34726f0bb5.jpg"
			
			
			
			loading="lazy"
			>
	</a>
	
</figure></p>
<p>BGA(ball grid array) 球形触点陈列，表面贴装型封装之一。在印刷基板的背面按陈列方式制作出球形凸点用以 代替引脚，在印刷基板的正面装配NANDflash 芯片，然后用模压树脂或灌封方法进行密封。封装本体也可做的比QFP(四侧引脚扁平封装)小。</p>
<p>BGA主要特点：1、I/O引脚数虽然增多，但引脚之间的距离远大于QFP封装方式，提高了成品率 2、虽然BGA的功耗增加，但由于采用的是可控塌陷芯片法焊接，从而可以改善电热性能 3、信号传输延迟小，适应频率大大提高 4、组装可用共面焊接，可靠性大大提高。此封闭应用在NAND FLASH方面，主要影响是：1、可针对一些大尺寸晶圆进行封装。2、减小NAND flash封装片的面积，适用于对于主板尺寸要求严格的产品，特别是近些年来的可穿戴设备，对于产品尺寸的要求相当严格。3、此封闭大部分为原装片使用。黑片相对较少使用BGA。</p>
<h2 id="ftl简介">FTL简介</h2>
<p>FTL是<code>Flash Translation Layer</code>(闪存转换层)的缩写，</p>
<p>完成主机(或者用户，Host)逻辑地址空间到闪存(Flash)物理地址空间的翻译(Translation),或者说映射(Mapping)。SSD每把一笔用户逻辑数据写人闪存地址空间，便记录下该逻辑地址到物理地址的映射关系。当主机想读取该数据时，SSD便会根据这个映射，从闪存读取这笔数据然后返回给用户。</p>
<h3 id="基本功能">基本功能</h3>
<p>完成逻辑地址空间到物理地址空间的映射。</p>
<p>闪存的特性：</p>
<p>（1） 闪存块（Block）不能覆盖写，需要维护一张逻辑地址到物理地址的映射表，FTL需要做垃圾回 收，即使GC (Garbage Collection, 垃圾回收)</p>
<p>（2） 闪存块有一定寿命，FTL需要做Wear Leveling,让数据写入均摊到每个闪存块上，即让每个块磨损都差不多，从而保证SSD具有最大的数据写入量。</p>
<p>（3） 闪存块读的次数有限，次数过多会有读干扰（具体见第三章），FTL需要处理读干扰问题，当某个闪存块读的次数将要达到一定阈值时，FTL需要把这些数据从该闪存块上搬走，从而避免数据出错。</p>
<p>（4） 数据的保存问题，必须上电，FTL才有效，好的FTL，就需要有处理数据保持问题的能力。</p>
<p>（5） 坏块问题，FTL管理坏块。</p>
<p>（6） 对MLC或TLC来说，存在<code>Lower Page corruption</code>的问题。即掉电异常问题。好的FTL，应该有机制避免这个问题。</p>
<p>（7） MLC或TLC的读写速度都不如SLC,但它们都可以配成SLC模式来使用。好的FTL，会利用该特性去改善SSD的性能和可靠性。</p>
<h3 id="映射管理">映射管理</h3>
<p>分类：</p>
<p>（1）块映射：块映射有好的连续大尺寸的读写性能，但小尺寸数据的写性能是非常糟糕的。</p>
<p>（2）页映射：闪存页远比闪存块多，因此需要更多的空间来存储映射表。但它的性能更好，尤其体现在随机写上面。为追求性能，SSD一般都采用页映射。</p>
<p>（3）混合映射：块内采用页映射的方式。</p>
<pre><code>映射表大小=SSD大小/逻辑页大小
</code></pre>
<p>（准确来说，映射表大小是SSD容量大小的1/1024。前提条件是:映射页大小为4KB,物理地址用4Byte表示。）.</p>
<p>映射表存储在DRAM中，</p>
<p>HMD ( Host Memory Buffer，主机高速缓冲存储器)：主机在内存中专门划出一部分空间给SSD用，SSD可以把它当成自己的DRAM 使用。因此，映射表完全可以放到主机端的内存中去。</p>
<h3 id="垃圾回收">垃圾回收</h3>
<p>垃圾回收就是把某个闪存块上的有效数据读出来，重写，然后把该闪存块擦除，就得到新的可用闪存块了。</p>
<p><figure 
	>
	<a href="https://img.picui.cn/free/2024/08/19/66c349546f2e3.jpg" >
		<img src="https://img.picui.cn/free/2024/08/19/66c349546f2e3.jpg"
			
			
			
			loading="lazy"
			>
	</a>
	
</figure></p>
<p>随机存取时候，如何挑选要回收的内存块，挑垃圾比较多的闪存块来回收，因为有效数据少，要搬移的数据少，这样腾出空闪存块的速度快。</p>
<h3 id="写放大wa">写放大（WA）</h3>
<p><figure 
	>
	<a href="https://img.picui.cn/free/2024/08/19/66c34968377b9.jpg" >
		<img src="https://img.picui.cn/free/2024/08/19/66c34968377b9.jpg"
			
			
			
			loading="lazy"
			>
	</a>
	
</figure></p>
<p>写放大越大，意味着额外写人闪存的数据越多，一方面磨损闪存，减少SSD寿命，另一方面，写人这些额外数据会占用底层闪存带宽，影响SSD性能。</p>
<p>解决方法：</p>
<p>顺序写（不可控）</p>
<p>增大OP（预留空间）（可控）</p>
<p><figure 
	>
	<a href="https://img.picui.cn/free/2024/08/19/66c349866d5d9.jpg" >
		<img src="https://img.picui.cn/free/2024/08/19/66c349866d5d9.jpg"
			
			
			
			loading="lazy"
			>
	</a>
	
</figure></p>
<p>OP越大，写放大越小：（很好理解，OP越大，每个闪存块有效数据越少，垃圾越多，因此需要重写更少的数据，因此写放大越小。同时，由于GC需要重写的数据越少，SSD满盘写性能也越好。）</p>
<p><figure 
	
		class="gallery-image" 
		style="
			flex-grow: 163; 
			flex-basis: 391px"
	>
	<a href="/2024/intossd/OPSUM.jpg" data-size="613x376">
		<img src="/2024/intossd/OPSUM.jpg"
			width="613"
			height="376"
			srcset="/2024/intossd/OPSUM_hu8b45d73e2871f3b5220b570fa03d0cb2_56019_480x0_resize_q75_box.jpg 480w, /2024/intossd/OPSUM_hu8b45d73e2871f3b5220b570fa03d0cb2_56019_1024x0_resize_q75_box.jpg 1024w"
			loading="lazy"
			>
	</a>
	
</figure></p>
<h3 id="垃圾回收可以简单地分为三步">垃圾回收可以简单地分为三步</h3>
<p>1 )挑选源闪存块。（BPA算法）</p>
<p>2 )从源闪存块中找有效数据。</p>
<p>3)把有效数据写人到目标闪存块。</p>
<h3 id="垃圾回收时机">垃圾回收时机</h3>
<p>（1）当用户写人数据时，如果可用的闪存块小于一定阈值，这时就需要做GC，以腾出空间给用户写。这时做的GC，叫作Foreground GC (前台垃圾回收)。(被动)</p>
<p>（2）<code>Background GC</code> (后台垃圾回收)，它是在SSD空闲(Idle)的时候，SSD主动去做的GC，这样在用户写人的时候就有充裕的可用闪存块，不需要临时抱佛脚(做<code>Foreground GC</code>)，从而改善用户写人性能。但是，出于功耗考虑，有些SSD可能就不做后台垃圾回收了，当SSD空闲后，直接进入省电模式，或者做少量的GC，然后进人省电模式。（主动）</p>
<p><code>Trim</code>（移除）：新增的ATA命令(<code>Data Set Management</code>)， 专为SSD而生</p>
<p><figure 
	
		class="gallery-image" 
		style="
			flex-grow: 206; 
			flex-basis: 494px"
	>
	<a href="/2024/intossd/trim1.jpg" data-size="464x225">
		<img src="/2024/intossd/trim1.jpg"
			width="464"
			height="225"
			srcset="/2024/intossd/trim1_hu760376fa8b6110008c57fc3608086e08_23859_480x0_resize_q75_box.jpg 480w, /2024/intossd/trim1_hu760376fa8b6110008c57fc3608086e08_23859_1024x0_resize_q75_box.jpg 1024w"
			loading="lazy"
			>
	</a>
	
</figure></p>
<p>在没有Trim之前，SSD无法知道那些被删除的数据页是否无效，必须等到系统要求在相同的地方(用户空间、逻辑空间)写人数据时才知道那些数据是无效的，进而放心删除。</p>
<p>一般FTL都有这3个表：</p>
<p>（1）FTL映射表记录每个LBA对应的物理页位置；</p>
<p>（2）<code>Valid Page Bit Map (VPBM)</code>记录每个物理块上哪个页有有效数据；</p>
<p>（3）<code>Valid Page Count (VPC)</code>则记录每个物理块上的有效页个数。</p>
<p>通常GC会使用VPC进行排序来回收最少有效页的闪存块; VPBM则是为了在GC时只读有用的数据，也有部分FTL会省略这个表。</p>
<p>SSD收到Trim命令后，为了实现数据删除，固件要按顺序做以下的事情：</p>
<p><figure 
	
		class="gallery-image" 
		style="
			flex-grow: 292; 
			flex-basis: 701px"
	>
	<a href="/2024/intossd/ftl1.jpg" data-size="421x144">
		<img src="/2024/intossd/ftl1.jpg"
			width="421"
			height="144"
			srcset="/2024/intossd/ftl1_hudbf14e1f374a048e96239a1158b20e0c_15191_480x0_resize_q75_box.jpg 480w, /2024/intossd/ftl1_hudbf14e1f374a048e96239a1158b20e0c_15191_1024x0_resize_q75_box.jpg 1024w"
			loading="lazy"
			>
	</a>
	
</figure></p>
<p>5~7是Trim命令处理后，GC的处理，不是Trim命令处理的部分。Trim命令不触发GC。</p>
<p><figure 
	
		class="gallery-image" 
		style="
			flex-grow: 417; 
			flex-basis: 1002px"
	>
	<a href="/2024/intossd/ftl2.jpg" data-size="405x97">
		<img src="/2024/intossd/ftl2.jpg"
			width="405"
			height="97"
			srcset="/2024/intossd/ftl2_hud461f7907e7a5813635f12328a86e594_11404_480x0_resize_q75_box.jpg 480w, /2024/intossd/ftl2_hud461f7907e7a5813635f12328a86e594_11404_1024x0_resize_q75_box.jpg 1024w"
			loading="lazy"
			>
	</a>
	
</figure></p>
<h3 id="磨损平衡">磨损平衡</h3>
<p>磨损平衡，就是让SSD中的每个闪存块的磨损(擦除)都保持均衡。</p>
<p>冷数据(<code>Cold Data</code>)： 不经常更新的块</p>
<p>热数据(<code>Hot Data</code>)： 更新频繁的数据</p>
<p>年老的(<code>Old</code>)块： 擦写次数较多的块</p>
<p>年轻的(<code>Young</code>)块： 擦写次数较少的块 EC（擦除次数）</p>
<p>SSD一般有动态磨损平衡(<code>Dynamic WL</code>)和静态磨损平衡(<code>Static WL</code>)两种算法。</p>
<p>动态磨损平衡算法的基本思想是把热数据写到年轻的块上，即在拿一个新的闪存块用来写的时候，挑选擦写次数小的;</p>
<p>静态磨损平衡算法基本思想是把冷数据写到年老的块上，即把冷数据搬到擦写次数比较多的闪存块上。</p>
<h3 id="掉电恢复">掉电恢复</h3>
<p>正常掉电：</p>
<p><figure 
	
		class="gallery-image" 
		style="
			flex-grow: 259; 
			flex-basis: 623px"
	>
	<a href="/2024/intossd/outpower.jpg" data-size="577x222">
		<img src="/2024/intossd/outpower.jpg"
			width="577"
			height="222"
			srcset="/2024/intossd/outpower_hu5ddef909ae9efba8e0839f537961b10b_37322_480x0_resize_q75_box.jpg 480w, /2024/intossd/outpower_hu5ddef909ae9efba8e0839f537961b10b_37322_1024x0_resize_q75_box.jpg 1024w"
			loading="lazy"
			>
	</a>
	
</figure></p>
<p>异常掉电：</p>
<pre><code>为防止异常掉电导致的数据丢失，一个简单的设计就是在SSD上加电容，SSD一旦检测到掉电，就让电容开始放电，然后把RAM中的数据刷到闪存上面去，从而避免数据丢失。
</code></pre>
<h3 id="重构">重构</h3>
<p>SSD在把用户数据写到闪存的时候，会额外打包一些数据，我们叫它元数据，(<code>Meta Data</code>)</p>
<p>映射表恢复原理：</p>
<p>只要全盘扫描整个闪存空间，就能获得所有的映射关系，最终完成整个映射表的重构。（time过长）</p>
<h3 id="坏块管理">坏块管理</h3>
<p>坏块主要来源于：</p>
<pre><code>	1、出厂坏块（Factory Bad Block）
	2、增长坏块（Grown Bad Block）
</code></pre>
<p>坏块管理策略：</p>
<p>一是略过(Skip) 策略，</p>
<p>二是替换(Replace)策略。（用户空间与预留空间）采用替换策略，SSD内部需维护一张重映射表(<code>Remap Table</code>) ;</p>
<h3 id="slc-cache">SLC Cache</h3>
<p>SLC相对MLC和TLC来说，有更好的读写性能和更长的寿命。这里所说的SLC Cache是把MLC或者TLC里面的一些闪存块配置成SLC模式来访问。</p>
<p>优点：</p>
<p>（1） 性能考虑</p>
<p>（2） 防止Lower Page数据被带坏</p>
<p>（3） 解决闪存的缺陷</p>
<p>（4） 更多的数据写入量</p>
<p>强制写人策略能保护Lower Page数据，而后者不能。非强制SLC写入策略，具有更好的后期写入性能。</p>
<h3 id="rddr">RD&amp;DR</h3>
<p>RD指的是<code>Read Disturb</code>（读打扰），DR指的是<code>Data Retention</code>（数据保留）。 两者都能导致数据丢失，但原理和固件处理方式都不一样。</p>
<p>Host Based FTL：</p>
<p><code>Device Based</code>存在以下缺点:</p>
<p>（1）FTL架构通用，不能针对具体应用做定制化。</p>
<p>（2）控制器芯片功能复杂，设计难度大，研发成本高。</p>
<p>（3）闪存更新很快，一般每年闪存厂商都会推出新一代产品，有新的使用特性，需要控制器芯片做出修改，但是芯片改版成本很高。</p>
<p>（4）企业级应用需要高性能、大容量，通用控制器芯片支持的最大性能和容量有限制。</p>
<p>（5）企业级市场需求多种多样，有些需求需要控制器提供特殊功能支持，这些是通用SSD主控芯片无法提供的。</p>
<h3 id="host-based-ftl架构">Host Based FTL架构</h3>
<p>Host Based SSD一般的模式是把闪存的读写接口直接开放给驱动程序，这样驱动程序就能自行管理闪存内部资源。控制器大都采用可编程逻辑器件FPGA，功能比较简单，主要实现ECC纠错和闪存时序控制。如图所示，主机驱动直接管理闪存阵列，控制器只是起到ECC纠错算法和物理协议转换的作用。</p>

</section>


    <footer class="article-footer">
    
    <section class="article-tags">
        
            <a href="/tags/ssd/">SSD</a>
        
    </section>


    
    <section class="article-copyright">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <path d="M14.5 9a3.5 4 0 1 0 0 6" />
</svg>



        <span>Licensed under CC BY-NC-SA 4.0</span>
    </section>
    </footer>


    
        <link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/katex.min.css"integrity="sha384-RZU/ijkSsFbcmivfdRBQDtwuwVqK7GMOw6IMvKyeWL2K5UAlyp6WonmB8m7Jd0Hn"crossorigin="anonymous"
            ><script 
                src="https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/katex.min.js"integrity="sha384-pK1WpvzWVBQiP0/GjnvRxV4mOb0oxFuyRxJlk6vVw146n3egcN5C925NCP7a7BY8"crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/contrib/auto-render.min.js"integrity="sha384-vZTG03m&#43;2yp6N6BNi5iM4rW4oIwk5DfcNdFfxkk9ZWpDriOkXX8voJBFrAO7MpVl"crossorigin="anonymous"
                defer
                >
            </script><script>
    window.addEventListener("DOMContentLoaded", () => {
        renderMathInElement(document.querySelector(`.article-content`), {
            delimiters: [
                { left: "$$", right: "$$", display: true },
                { left: "$", right: "$", display: false },
                { left: "\\(", right: "\\)", display: false },
                { left: "\\[", right: "\\]", display: true }
            ]
        });})
</script>
    
</article>

    <aside class="related-contents--wrapper">
    
    
        <h2 class="section-title">相关文章</h2>
        <div class="related-contents">
            <div class="flex article-list--tile">
                
                    
<article class="has-image">
    <a href="/2024/ssd-fw/">
        
        
            <div class="article-image">
                <img src="/2024/ssd-fw/SSDFW-MAIN.e4ae0a1426461630cb18fb100ce96cde_hu0e0cb618b8fd3ce0fb65d459aa58a52e_143118_250x150_fill_q75_box_smart1.jpg" 
                        width="250" 
                        height="150" 
                        loading="lazy"
                        alt="Featured image of post SSD开卡"
                        data-key="SSD-FW" 
                        data-hash="md5-5K4KFCZGFjDLGPsQDOls3g==">
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">SSD开卡</h2>
        </div>
    </a>
</article>
                
                    
<article class="has-image">
    <a href="/2024/intoram/">
        
        
            <div class="article-image">
                
                    <img src="https://img.picui.cn/free/2024/08/19/66c31be1e7277.jpg" loading="lazy" data-key="IntoRAM" data-hash="https://img.picui.cn/free/2024/08/19/66c31be1e7277.jpg"/>
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">RAM</h2>
        </div>
    </a>
</article>
                
            </div>
        </div>
    
</aside>

     
     
        
    <link rel="stylesheet" href="https://unpkg.com/vssue/dist/vssue.min.css" />

<div id="vssue"></div>

<script src="https://unpkg.com/vue/dist/vue.runtime.min.js"></script>
<script src="https://unpkg.com/vssue/dist/vssue.Github.min.js"></script>

<script>
    new Vue({
        el: "#vssue",
        render: (h) =>
            h("Vssue", {
                props: {
                    title: "年度巨献 | 深入浅出SSD（持续更新）",
                    options: {
                        autoCreateIssue:  false ,
                        owner: "tfl-asp",
                        repo: "https:\/\/github.com\/TFL-ASP\/tfl-asp.github.io",
                        clientId: "Ov23liZA8ZDWGyREmLEn",
                        clientSecret: "9bddb14d14832ff28ee9150ccf53123a7fd90bbe",
                    },
                },
            }),
    });
</script>

    

    <footer class="site-footer">
  


    

    

    

    

    

    

    

    

    

    

    

    

    

    


<script>
(function(u, c) {
  var d = document, t = 'script', o = d.createElement(t),
      s = d.getElementsByTagName(t)[0];
  o.src = u;
  if (c) { o.addEventListener('load', function(e) { c(e); }); }
  s.parentNode.insertBefore(o, s);
})('//cdn.bootcss.com/pangu/3.3.0/pangu.min.js', function() {
  pangu.spacingPage();
});


</script>

    <section class="copyright">
        &copy; 
        
            2021 - 
        
        2024 <a href="https://www.tflasp.fun/">TFL-ASP</a>·<i class="fas fa-bell"></i> 
      共书写了19.5k字·共 10篇文章</br><span><p>
    </section>
  
      
<div class="busuanzi-footer">
  <span id="busuanzi_container_site_pv">
    本站总访问量<span id="busuanzi_value_site_pv"></span>次
  </span>
  <span id="busuanzi_container_site_uv">
    本站访客数<span id="busuanzi_value_site_uv"></span>人次
  </span>
</div>
    <section class="powerby">
        
            TFL's Personal Website | LTP 2.3.81 <br/>
         <br />
        <br />
         <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank">© Licensed Under CC BY-NC-SA 4.0</a>
    </section>

<script>
var s1 = '2024-07-07';
s1 = new Date(s1.replace(/-/g, "/"));
s2 = new Date();
var days = s2.getTime() - s1.getTime();
var number_of_days = parseInt(days / (1000 * 60 * 60 * 24));
document.getElementById('days').innerHTML = number_of_days;


</script>
    
</footer>



    
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    
    <div class="pswp__bg"></div>

    
    <div class="pswp__scroll-wrap">

        
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                
                
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo="crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU="crossorigin="anonymous"
                defer
                >
            </script><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.css"integrity="sha256-c0uckgykQ9v5k&#43;IqViZOZKc47Jn7KQil4/MP3ySA3F8="crossorigin="anonymous"
            ><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.css"integrity="sha256-SBLU4vv6CA6lHsZ1XyTdhyjJxCjPif/TRkjnsyGAGnE="crossorigin="anonymous"
            >

            </main>
    
    
    
    <aside class="sidebar right-sidebar sticky">
        
            <form action="/search/" class="search-form widget" >
        <p>
            <label>搜索</label>
            <input name="keyword" required placeholder="输入关键词..." />
        
            <button title="搜索">
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="10" cy="10" r="7" />
  <line x1="21" y1="21" x2="15" y2="15" />
</svg>



            </button>
        </p>
    </form>
        
            
    <section class="widget archives">
        <div class="widget-icon">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <line x1="5" y1="9" x2="19" y2="9" />
  <line x1="5" y1="15" x2="19" y2="15" />
  <line x1="11" y1="4" x2="7" y2="20" />
  <line x1="17" y1="4" x2="13" y2="20" />
</svg>



        </div>
        <h2 class="widget-title section-title">目录</h2>
        
        <div class="widget--toc">
            <nav id="TableOfContents">
  <ol>
    <li><a href="#ssd简介">SSD简介</a></li>
    <li><a href="#ssd-协议与接口">SSD 协议与接口</a>
      <ol>
        <li><a href="#pcie协议">PCIe协议</a>
          <ol>
            <li><a href="#pcie带宽">PCIe带宽</a></li>
            <li><a href="#pcie拓扑结构">PCIe拓扑结构</a></li>
            <li><a href="#pcie-transaction">PCIe Transaction</a></li>
          </ol>
        </li>
        <li><a href="#nvme介绍">NVMe介绍</a>
          <ol>
            <li><a href="#nvme综述">NVMe综述</a></li>
          </ol>
        </li>
      </ol>
    </li>
    <li><a href="#ssd-主控与闪存">SSD 主控与闪存</a>
      <ol>
        <li><a href="#主控概述">主控概述</a></li>
        <li><a href="#nand-flash概述">NAND Flash概述</a></li>
        <li><a href="#nand-flash-数据存储单元整体架构">NAND Flash 数据存储单元整体架构</a></li>
        <li><a href="#nand-flash-封装">NAND Flash 封装</a></li>
      </ol>
    </li>
    <li><a href="#ftl简介">FTL简介</a>
      <ol>
        <li><a href="#基本功能">基本功能</a></li>
        <li><a href="#映射管理">映射管理</a></li>
        <li><a href="#垃圾回收">垃圾回收</a></li>
        <li><a href="#写放大wa">写放大（WA）</a></li>
        <li><a href="#垃圾回收可以简单地分为三步">垃圾回收可以简单地分为三步</a></li>
        <li><a href="#垃圾回收时机">垃圾回收时机</a></li>
        <li><a href="#磨损平衡">磨损平衡</a></li>
        <li><a href="#掉电恢复">掉电恢复</a></li>
        <li><a href="#重构">重构</a></li>
        <li><a href="#坏块管理">坏块管理</a></li>
        <li><a href="#slc-cache">SLC Cache</a></li>
        <li><a href="#rddr">RD&amp;DR</a></li>
        <li><a href="#host-based-ftl架构">Host Based FTL架构</a></li>
      </ol>
    </li>
  </ol>
</nav>
        </div>
    </section>

        
            <section class="widget categories">
        <div class="widget-icon">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-infinity" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M9.828 9.172a4 4 0 1 0 0 5.656 a10 10 0 0 0 2.172 -2.828a10 10 0 0 1 2.172 -2.828 a4 4 0 1 1 0 5.656a10 10 0 0 1 -2.172 -2.828a10 10 0 0 0 -2.172 -2.828" />
</svg>


  
        </div> 
        <h2 class="widget-title section-title">Categories</h2>
    <div class="widget-categories--list">
<div class="widget">
    <h3 class="widget-title"> </h3>
    <div class="widget-body">
        <div class="category-list">
            <div class="category-list-item"><a href="https://tflasp.fun/categories/hugo/" class="category-list-link">hugo<span class="category-list-count">2</a>
            </span></div>
            <div class="category-list-item"><a href="https://tflasp.fun/categories/pve/" class="category-list-link">pve<span class="category-list-count">1</a>
            </span></div>
            <div class="category-list-item"><a href="https://tflasp.fun/categories/ram/" class="category-list-link">ram<span class="category-list-count">1</a>
            </span></div>
            <div class="category-list-item"><a href="https://tflasp.fun/categories/software/" class="category-list-link">software<span class="category-list-count">1</a>
            </span></div>
            <div class="category-list-item"><a href="https://tflasp.fun/categories/ssd/" class="category-list-link">ssd<span class="category-list-count">2</a>
            </span></div>
            <div class="category-list-item"><a href="https://tflasp.fun/categories/%E5%89%8D%E6%B2%BF%E6%8A%80%E6%9C%AF/" class="category-list-link">前沿技术<span class="category-list-count">3</a>
            </span></div>
            <div class="category-list-item"><a href="https://tflasp.fun/categories/%E6%95%99%E7%A8%8B/" class="category-list-link">教程<span class="category-list-count">3</a>
            </span></div>
            <div class="category-list-item"><a href="https://tflasp.fun/categories/%E8%AE%B0%E5%BD%95/" class="category-list-link">记录<span class="category-list-count">1</a>
            </span></div>
            <div class="category-list-item"><a href="https://tflasp.fun/categories/%E9%93%BE%E6%8E%A5/" class="category-list-link">链接<span class="category-list-count">1</a>
            </span></div>
        </div>
    </div>
</div>
    </div>
    </section>
        
            <section class="widget archives">
        <div class="widget-icon">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-infinity" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M9.828 9.172a4 4 0 1 0 0 5.656 a10 10 0 0 0 2.172 -2.828a10 10 0 0 1 2.172 -2.828 a4 4 0 1 1 0 5.656a10 10 0 0 1 -2.172 -2.828a10 10 0 0 0 -2.172 -2.828" />
</svg>



        </div>
        <h2 class="widget-title section-title">归档</h2>

        
        
        
        
        
        <div class="widget-archive--list">
            <div class="archives-year">
                    <a href="/archives/#2024">
                        
                            <span class="year">2024</span>
                            <span class="count">7</span>
                        
                    </a> 
                </div>
            <div class="archives-year">
                    <a href="/archives/#2021">
                        
                            <span class="year">2021</span>
                            <span class="count">1</span>
                        
                    </a> 
                </div>
            <div class="archives-year">
                    <a href="/archives/#2020">
                        
                            <span class="year">2020</span>
                            <span class="count">2</span>
                        
                    </a> 
                </div>
            
        </div>
    </section>
        
            <section class="widget tagCloud">
    <div class="widget-icon">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-tag" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M11 3L20 12a1.5 1.5 0 0 1 0 2L14 20a1.5 1.5 0 0 1 -2 0L3 11v-4a4 4 0 0 1 4 -4h4" />
  <circle cx="9" cy="9" r="2" />
</svg>



    </div>
    <h2 class="widget-title section-title">标签云</h2>

    <div class="tagCloud-tags">
        
            <a href="/tags/ssd/" class="font_size_2">
                SSD
            </a>
        
            <a href="/tags/css/" class="font_size_1">
                Css
            </a>
        
            <a href="/tags/html/" class="font_size_1">
                Html
            </a>
        
            <a href="/tags/hugo/" class="font_size_1">
                Hugo
            </a>
        
            <a href="/tags/markdown/" class="font_size_1">
                Markdown
            </a>
        
            <a href="/tags/pve/" class="font_size_1">
                PVE
            </a>
        
            <a href="/tags/ram/" class="font_size_1">
                RAM
            </a>
        
            <a href="/tags/software/" class="font_size_1">
                Software
            </a>
        
            <a href="/tags/themes/" class="font_size_1">
                Themes
            </a>
        
            <a href="/tags/%E8%AE%B0%E5%BD%95/" class="font_size_1">
                记录
            </a>
        
    </div>
</section>
        
    </aside>


        </div>
        <script 
                src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.5/dist/vibrant.min.js"integrity="sha256-5NovOZc4iwiAWTYIFiIM7DxKUXKWvpVEuMEPLzcm5/g="crossorigin="anonymous"
                
                >
            </script><script type="text/javascript" src="/ts/main.js" defer></script>
<script>
    (function () {
        const customFont = document.createElement('link');
        customFont.href = "https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";

        customFont.type = "text/css";
        customFont.rel = "stylesheet";

        document.head.appendChild(customFont);
    }());
</script>

    </body>
</html>
