[{"content":"以 ubuntu 20.04（也包括作为桌面使用的 Linux Mint 21） 为例，参考官网文档：\nhttps://docs.docker.com/install/linux/docker-ce/ubuntu/\n安装准备 看一下自己的Linux机器版本和内核信息：\nuname --all\nLinux skywork 5.15.0-53-generic #59-Ubuntu SMP Mon Oct 17 18:53:30 UTC 2022 x86_64 x86_64 x86_64 GNU/Linux\rcat /proc/version\nLinux version 5.15.0-53-generic (buildd@lcy02-amd64-047) (gcc (Ubuntu 11.2.0-19ubuntu1) 11.2.0, GNU ld (GNU Binutils for Ubuntu) 2.38) #59-Ubuntu SMP Mon Oct 17 18:53:30 UTC 2022\rlsb_release -a\nNo LSB modules are available.\rDistributor ID:\tLinuxmint\rDescription:\tLinux Mint 21\rRelease:\t21\rCodename:\tvanessa\r这台机器是Linux Mint 21 升级到非常新的Linux内核5.15.0-53了，Linux Mint 21 是基于 Ubuntu 20.04，但是有些系统参数不一样，比如这里 Codename 是 vanessa，而不是 Ubuntu 20.04 的 Focal Fossa。后面安装时要小心，需要修改为 Ubuntu 20.04 的参数。\nubuntu各个版本的codename 请见：https://download.docker.com/linux/ubuntu/dists/\n安装步骤 卸载旧版本 sudo apt-get remove docker docker-engine docker.io containerd runc\r安装docker 简单起见，使用 docker 仓库安装。\n$ sudo apt-get install ca-certificates curl gnupg lsb-release\r$ curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo gpg --dearmor -o /usr/share/keyrings/docker-archive-keyring.gpg\r# 官方给的是这样，\r# echo \\\r# \u0026quot;deb [arch=$(dpkg --print-architecture) signed-by=/usr/share/keyrings/docker-archive-keyring.gpg] \\\r# https://download.docker.com/linux/ubuntu \\\r# $(lsb_release -cs) stable\u0026quot; | sudo tee /etc/apt/sources.list.d/docker.list \u0026gt; /dev/null\r# 但是`lsb_release -cs`在Linux Mint下取值会不对，因此手工修改\r# for ubuntu 20.04 / linuxmint 20.02，$(lsb_release -cs)替代为 focal\r$ echo \\\r\u0026quot;deb [arch=$(dpkg --print-architecture) signed-by=/usr/share/keyrings/docker-archive-keyring.gpg] https://download.docker.com/linux/ubuntu focal stable\u0026quot; | sudo tee /etc/apt/sources.list.d/docker.list \u0026gt; /dev/null\r$ sudo apt-get update\r$ sudo apt-get install docker-ce docker-ce-cli containerd.io\r如果不想安装最新版本，则可以先查看当前可选版本：\n$ apt-cache madison docker-ce\rdocker-ce | 5:20.10.21~3-0~ubuntu-focal | https://download.docker.com/linux/ubuntu focal/stable amd64 Packages\rdocker-ce | 5:20.10.20~3-0~ubuntu-focal | https://download.docker.com/linux/ubuntu focal/stable amd64 Packages\rdocker-ce | 5:20.10.19~3-0~ubuntu-focal | https://download.docker.com/linux/ubuntu focal/stable amd64 Packages\rdocker-ce | 5:20.10.18~3-0~ubuntu-focal | https://download.docker.com/linux/ubuntu focal/stable amd64 Packages\rdocker-ce | 5:20.10.17~3-0~ubuntu-focal | https://download.docker.com/linux/ubuntu focal/stable amd64 Packages\rdocker-ce | 5:20.10.16~3-0~ubuntu-focal | https://download.docker.com/linux/ubuntu focal/stable amd64 Packages\rdocker-ce | 5:20.10.15~3-0~ubuntu-focal | https://download.docker.com/linux/ubuntu focal/stable amd64 Packages\rdocker-ce | 5:20.10.14~3-0~ubuntu-focal | https://download.docker.com/linux/ubuntu focal/stable amd64 Packages\rdocker-ce | 5:20.10.13~3-0~ubuntu-focal | https://download.docker.com/linux/ubuntu focal/stable amd64 Packages\rdocker-ce | 5:20.10.12~3-0~ubuntu-focal | https://download.docker.com/linux/ubuntu focal/stable amd64 Packages\rdocker-ce | 5:20.10.11~3-0~ubuntu-focal | https://download.docker.com/linux/ubuntu focal/stable amd64 Packages\rdocker-ce | 5:20.10.10~3-0~ubuntu-focal | https://download.docker.com/linux/ubuntu focal/stable amd64 Packages\rdocker-ce | 5:20.10.9~3-0~ubuntu-focal | https://download.docker.com/linux/ubuntu focal/stable amd64 Packages\rdocker-ce | 5:20.10.8~3-0~ubuntu-focal | https://download.docker.com/linux/ubuntu focal/stable amd64 Packages\rdocker-ce | 5:20.10.7~3-0~ubuntu-focal | https://download.docker.com/linux/ubuntu focal/stable amd64 Packages\rdocker-ce | 5:20.10.6~3-0~ubuntu-focal | https://download.docker.com/linux/ubuntu focal/stable amd64 Packages\rdocker-ce | 5:20.10.5~3-0~ubuntu-focal | https://download.docker.com/linux/ubuntu focal/stable amd64 Packages\rdocker-ce | 5:20.10.4~3-0~ubuntu-focal | https://download.docker.com/linux/ubuntu focal/stable amd64 Packages\rdocker-ce | 5:20.10.3~3-0~ubuntu-focal | https://download.docker.com/linux/ubuntu focal/stable amd64 Packages\rdocker-ce | 5:20.10.2~3-0~ubuntu-focal | https://download.docker.com/linux/ubuntu focal/stable amd64 Packages\rdocker-ce | 5:20.10.1~3-0~ubuntu-focal | https://download.docker.com/linux/ubuntu focal/stable amd64 Packages\rdocker-ce | 5:20.10.0~3-0~ubuntu-focal | https://download.docker.com/linux/ubuntu focal/stable amd64 Packages\rdocker-ce | 5:19.03.15~3-0~ubuntu-focal | https://download.docker.com/linux/ubuntu focal/stable amd64 Packages\rdocker-ce | 5:19.03.14~3-0~ubuntu-focal | https://download.docker.com/linux/ubuntu focal/stable amd64 Packages\rdocker-ce | 5:19.03.13~3-0~ubuntu-focal | https://download.docker.com/linux/ubuntu focal/stable amd64 Packages\rdocker-ce | 5:19.03.12~3-0~ubuntu-focal | https://download.docker.com/linux/ubuntu focal/stable amd64 Packages\rdocker-ce | 5:19.03.11~3-0~ubuntu-focal | https://download.docker.com/linux/ubuntu focal/stable amd64 Packages\rdocker-ce | 5:19.03.10~3-0~ubuntu-focal | https://download.docker.com/linux/ubuntu focal/stable amd64 Packages\rdocker-ce | 5:19.03.9~3-0~ubuntu-focal | https://download.docker.com/linux/ubuntu focal/stable amd64 Packages\r然后执行 :\nsudo apt-get install docker-ce=20.10.21~3-0~ubuntu\r验证安装 安装完成之后，看一下版本信息：\n$ docker --version\rDocker version 20.10.21, build baeda1f\r验证一下：\nsudo docker run hello-world\r输出如下：\n$ sudo docker run hello-world\rUnable to find image 'hello-world:latest' locally\rlatest: Pulling from library/hello-world\r2db29710123e: Pull complete Digest: sha256:faa03e786c97f07ef34423fccceeec2398ec8a5759259f94d99078f264e9d7af\rStatus: Downloaded newer image for hello-world:latest\rHello from Docker!\rThis message shows that your installation appears to be working correctly.\r...\r设置权限避免每次sudo 为了以非root用户使用docker, 可以将用户加入\u0026quot;docker\u0026quot;组.\nsudo usermod -aG docker sky\r重新登录之后生效。\n设置docker的cgroup driver 备注： 发现 docker 20.10.213-0ubuntu 版本已经修改为默认 systemd ，因此新版本可以不用这么设置。\ndocker 默认的 cgroup driver 是 cgroupfs，可以通过 docker info 命令查看：\n$ docker info | grep \u0026quot;Cgroup Driver\u0026quot;\rCgroup Driver: cgroupfs\r而 kubernetes 在v1.22版本之后，如果用户没有在 KubeletConfiguration 下设置 cgroupDriver 字段，则 kubeadm 将默认为 systemd。\n为了保持一致，需要修改 docker 的 cgroup driver 为 systemd, 方式为打开 docker 的配置文件（如果不存在则创建）\nsudo vi /etc/docker/daemon.json\r增加内容：\n{\r\u0026quot;exec-opts\u0026quot;: [\u0026quot;native.cgroupdriver=systemd\u0026quot;]\r}\r修改完成后重启 docker：\nsudo systemctl restart docker\r# 重启后检查一下\rdocker info | grep \u0026quot;Cgroup Driver\u0026quot;\r设置swap limit 如果遇到如下的 \u0026ldquo;No swap limit support\u0026rdquo; 警告：\ndocker info | grep \u0026quot;Cgroup Driver\u0026quot;\rCgroup Driver: systemd\rWARNING: No swap limit support\r则说明 swap limit 功能没能开启。解决方法是 grub\n$ sudo vi /etc/default/grub\r......\rGRUB_CMDLINE_LINUX=\u0026quot;cgroup_enable=memory swapaccount=1\u0026quot;\r......\r如果 GRUB_CMDLINE_LINUX= 内有内容，切记不可删除，只需在后面追加，并用空格和前面的内容分隔开。\n执行下面命令生效并重启。\n$ sudo update-grub2\r$ sudo reboot\r参考资料 https://www.k2zone.cn/?p=2356 https://unix.stackexchange.com/questions/342735/docker-warning-no-swap-limit-support ","date":"2024-08-23T00:00:00Z","permalink":"https://tflasp.fun/2024/docker-setup-ubuntu/","title":"【归档】Ubuntu20.04下安装Docker"},{"content":"下载时记得关闭杀毒软件，若被误杀请重新下载。\n资料由站长收集整理，仅供学习交流，严禁用于商业用途，请于24小时内删除。\nName Password Windows10永久数字激活工具 \\ Geek Uninstaller卸载工具 \\ ExecTI提权工具 9ywa Everything \\ DragonKMS Activator \\ Dism++ \\ DiskGeniusPRO \\ AIDA64 \\ Rufus 5k8t FastCopy \\ EasyUEFI 4bva RaiDrive2020.11.30 Old version faqd TotalCMD h65b BOOTICE \\ Windows Update Blocker \\ qBittorrent \\ AS SSD Benchmark 9uzk RAMOS \\ WinNTSetup \\ MBR recovery 1bz8 Windows 11 轻松设置 \\ CrystalDiskInfo \\ ","date":"2024-08-23T00:00:00Z","permalink":"https://tflasp.fun/2024/links/","title":"工具包分享"},{"content":"System Windows 第一台笔记本用的是Windows LTSC 2019（17763.6189），非常精简，砍掉了Microsoft store以及所有UWP应用。\n当时主Channel版本是21H1（19042.1），本想是通过Microsoft官方的MCT Update升级系统的（保留文件与设置），但由于LTSC与普通平台不在一个渠道里，所以自然也不在MCT所支持的升级版本里。\n于是顺藤摸瓜搞清楚了MacBook双系统的解决办法，以及BootCamp驱动。详见我写的教程：CSDN文章\n2021年6月，Windows 11首次泄露，同时我也搞了一份来体验（Build 22000.1）,这体验。。。把我最喜欢的磁贴给砍掉了，整体磨成圆角，越来越“果化”了。同时，Windows11对系统硬件增加了对TPM2.0的要求，这确实筛掉了很多老电脑，不过也可以通过修改注册表或者替换动态链接库（DLL文件）来实现安装Windows11，在此就不做教程了。\n2021年6月24日，微软发布Windows 11（22000.168），至此我电脑用上了3系统（MacOS+Windows10 21H2+Windows11）\n引导结构如下：\n├─MacOS Bootloader\r└─Windows Boot Manager\r├─Windows 10\r└─Windows 11\r在日常使用之外，我还喜欢尝试一些Insider Preview版本的系统，比如被号称为Windows 9的Windows Technical Preview Build 9834\nLinks Password Windows Technical Preview Build 9834 提取码：k2qe Edition / SKU Name Key Professional XHQ8N-C3MCJ-RQXB6-WCHYG-C9WKB Core 334NH-RXG76-64THK-C7CKG-D3VPT 然后就是不停的用最新版，跟着Windows10 19042一直到现在的19045，Windows11 22000到26100.1586,这三年算是随Windows一起迭代了吧哈哈，到后来随着事情越来越多，Windows update似乎确实有点烦人，索性组策略直接禁用了Windows update。\n截至2024年8月24日的Windows各Channel最新版本 Linux 除了Windows，当然少不了Linux。\n在尝试了Linux minit 、CentOS、Ubuntu后，最终还是选择了Ubuntu更适合我的使用逻辑，目前正作为服务器使用（Ubuntu server 2404 LTS）。\n由于Linux极高的可自定义性，目前在用Proxmox VE作为服务器Host系统，然后在其下安装虚拟机来最大化利用系统硬件资源。\nSoftware WSL、WSA、VMware、Hyper-V、FastCopy、Dism++、DiskGenius、FlashID等等实用工具，详见这里\n","date":"2024-08-22T00:00:00Z","image":"https://tflasp.fun/2024/record-sw/sys-10_hudf6c8ed3020b5124356a4d2faf46173f_54750_120x120_fill_q75_box_smart1.jpg","permalink":"https://tflasp.fun/2024/record-sw/","title":"一只垃圾佬的探索历程（软件系统篇）"},{"content":"梦开始的地方 2023年6月，最早的配置是：\nIntel Core i5-13400F\n铭瑄B760M WIFI\n华硕ATS RTX3060Ti\n威刚DDR4 3200 8*2\n鑫谷GN650W\nKIOXIA RC20 1T\naigo P7000Z 2TB\n在当时的性价比还算可以吧，当时12600KF的价格可谓是居高不下，索性选择了当时最新的13代13400F（线程数更多，对生产力友好一些）\n探索历程 主线-双路X79 在家用平台用腻了过后，一天在淘宝上看到了一个非常逆天的主板:Insuper M2220 X79.双路X79，仅需260包邮！带有10个SATA口，简直就是NAS党的福音！然后还能搭配超级便宜32元一根16GB的DDR3 RECC内存，实在是太香了，于是果断入手，开启了折腾之路。\n这个服务器板子是E-ATX规格，现在想起也是幸运，没有买到诸如RH2288HV3那种定制板子，普通机箱装不了。另外，折腾这个板子也是坎坷：\n1、开机慢：当然，本来就不是为家用而设计的，在启动时要加载BMC管理系统（带外管理），如果插入了直通卡，还要加载HBA卡的BIOS，总之，开机时间不会低于一分钟。\n2、10个SATA口识别不全：由于板子比较老（2013年的），所以查找官网资料也比较困难。这个板子有10个由C602芯片组引出来的SATA口，还有3个扩展出来的SAS接口（物理外形与SATA相同）。在排除了BIOS问题和硬件方面的问题后，最后发现是驱动问题。询问卖家要了驱动后，发现Windows10 22H2并不能打上驱动（安装ini），最后发现只有Windows server和某些Linux server的发行版才可以打上这个驱动，而Windows server的安全策略过于严格，导致并不适合日常使用。所以只能暂时放弃使用10个SATA的想法了\n3、不支持由NVME硬盘启动。这个其实比较好解决，提取BIOS，然后使用MMTool在BIOS内添加NVME驱动后，刷回BIOS内即可解决这个问题。（详见教程）\n4、功耗问题：这个是怕X79平台的硬伤，没有办法解决（只有换平台）\n主线-单路X79 由于双路X79平台功耗实在是太高了，电源650W带不太动，于是换到了单路X79平台（130包邮精粤X79M-PRO V2）\n更换平台主要是为日常使用考虑的，由于是寨板，所以并没有BMC带外管理，启动速度快得多。但是也催生了一个问题，主板MOS管温度非常高，即使带一个TDP为95W的E5-2650V2，mos管温度能达到110℃，经常因为供电温度原因降频死机，这让我顿悟：洋垃圾平台有他便宜的道理，还是家用平台更加稳定可靠。\n侧线-FM2、FM2+ 当然，只折腾主力机是一件比较痛苦的事情，所以就诞生了所谓二奶机的说法。我的第一台二奶机就是微星的A58 + AMD A4-6400K。也是第一次体验到MSI图形BIOS的统治力（就是使用逻辑不大好）。\n不得不说，老AMD的核显确实给力，Windows10日常办公非常流畅，作为一个办公机绰绰有余。但是，处理器部分就极为有限，虽然频率非常高，但是并不顶用。\n服务器线-B85 在认识了一位同道中人后，他把之前用的平台借给了我。就是这块B85和Intel Core i5-4460以及DDR3 1600 8*2和其他配件。本来打算用这套平台作为服务器的，但是他的线程数实在是太少了，只有4线程，并且功耗也不低，待机状况下有65W左右功耗，最终也只是让它跑Windows server 2019来进行一些磁盘类的操作（MHDD扫盘、磁盘清零的操作）。\n这块主板同样有值得折腾的点：\n1、同样不支持由NVME硬盘启动，解决方法可以借鉴上文折腾X79的操作。\n2、拥有6个原生SATA口（属于是把芯片组的所有通道用完了）：可以拿来当NAS之类的\n3、拥有两个Pciex1，可以拿来扩展一个2.5GB网卡和一个NVMe硬盘，配合2.5G交换机使用，实现内网2.5G化\n但是也就仅限与这些了，主要还是被CPU的性能与功耗所限制。\n侧线-龙芯3A2000C 在2024年初，在咸鱼上偶然看到一个主板，龙芯3A2000C itx主板，自带4个SATA口，36元包邮\n作为垃圾佬的直觉，果断入手\r但是由于这款主板挑内存，我手上6根DDR3普条都没有办法使它开机，于是也就没有了后续\n当然，随着有人把这块主板做成视频宣传后，主板在2个月后就断货了。半年后，我以66元的价格卖出去了（小赚一笔嘿嘿）\n侧线-P5PL2 偶然的一次机会，回老家翻出了一台老电脑。大概是2007年的时候装的吧。还是用的XP系统。拆开一看，真是老古董。奔腾4 631+华硕P5PL2-E主板，用料可以用豪华来形容。可是这个接近20年前的产品终究还是无法抵挡时间的摧残，虽然能开机，但是清灰后就不亮了（疑似打破了灰电平衡）。不得不说，奔腾的发热量真的是巨大，被动式散热根本压不住（甚至被烫了一下）。\n主线-AM4之光 众所周知，AMD YES!，在经历了最近的Intel的暴毙后，性价比极高的12600KF（低价为880）便不敢入手了。\n于是，目光转向了神U：AMD R5 5600（B2步进）。拥有大L3（32MB），打网游非常爽，属于千年性价比组合了。\n5600到手后，直接超频到4.75GHz 1.2V使用，体验非常好！\n配合上现在及其便宜的AM4板子，属于是颜值与性能同在了吧\n所以我现在的主力机配置为：\nAMD R5 5600 B2\n技嘉B550M AORUS ELITE\n光威DDR4 3200 16G\n利民TR TG850W\n技嘉GTX 1070Ti 8G Gaming\n利民AX120-SE风冷\n致态Tiplus5000 1TB\n西数SN730 256GB OEM\n不推荐抄作业，特别是显卡。这是我通过自己的需求搭出来的配置，很显然这里显卡方面弱了。\n侧线-MoDT平台 由于MoDT平台极高的性价比，以及Q1HY远超桌面平台的性能，于是就入手了TOPC（天邦）的Q1HY DDR4版本的板子。上手测试，原装的“均热板”太弱鸡了，不亚于AM4时代AMD的积热顶盖，导致一烤鸡就破百，撞温度墙，降频。于是就更换了尔英科技的itx均热板，烤鸡有缓解，但是手上也没有合适的散热器，最高规格的也都是上次压洋垃圾的6热管双塔风冷了。由于这个平台确实太吵了，于是也就只是过了下手玩了会就出了。\n不得不说，这个板子其实挺有搭建全闪NAS的潜力的。拥有3个M.2口，其中有两个PCIe4.0x（一个由PCH引出）4，一个PCIe3.0x4。其搭载的核显也可以加速视频解码使用。\n服务器线-X99 在体验了X79平台以后，似乎对洋垃圾平台（E3、E5）有了心里阴影，代表着高功耗与低主频。但是，志强也有低功耗的版本（后缀带L），比如这颗E5-2630LV3，TDP仅有55w（比i5-4460 TDP 84w要低得多）\n而且还Xeon的绝对优势：核心多。超适合开PVE，多开系统。于是就入手了这款HSGM X99 PF7。\n在实际上手后才知道其有两个SATA控制器（一个SATA，一个eSATA），在加上一张阵列卡即可将不同硬直通到三个虚拟机里，爽！\n并且这个板子还有一个特性，支持DDR3与DDR4双平台，也意味着其有极高的可玩性（D3 D4不能同时用，因为用的是不同的BIOS）\n实测该平台待机功耗为60w，能耗比显然比B85要高。\n服务器线-DELL WYSE瘦客户机 由于搭建网站，最初的想法是一个超低功耗的服务器来跑nginx和内网穿透，于是就入手了这款DELL-WYSE-3290瘦客户机。整体占地不大，功耗也可以控制在3-8W内（无感的功耗），同时被动散热也使它非常静音。虽然其搭载的CPU N2807非常弱，但是跑nginx还是非常好的。\n设计非常紧凑，麻雀虽小五脏俱全，DELL还是挺有水平的一家OEM公司（就是贵）\n现在正在拿来跑nginx，已经两三周没有关机了，除非供电源的问题，一般还是非常稳定的。\n总结 当然这篇文章永远不会到此结束，未来更多好玩的硬件还多着呢，这里只是想总结DIY精神：\n要么就是在折腾，要么就是在折腾的路上 垃圾佬买硬件几乎不是拿来常用的，而是拿来折腾的\n问折腾硬件有什么意义？\n就如人类为什么要举办奥运会，为什么要攀登珠穆朗玛峰一样，这个问题本身就没有意义，生命在于探索和不停地折腾！\n","date":"2024-08-22T00:00:00Z","image":"https://tflasp.fun/2024/record-hw/3A2000C_huaa52919b9611763bc4b860db58edaa8a_513863_120x120_fill_q75_box_smart1.jpg","permalink":"https://tflasp.fun/2024/record-hw/","title":"一只垃圾佬的探索历程（硬件平台篇）"},{"content":"问题重现 PVE 启动时，看到屏幕上有提示要求更新 microcode。\n添加仓库 需要添加 unstable repo：\necho \u0026quot;deb http://deb.debian.org/debian/ unstable non-free-firmware\u0026quot; \u0026gt; /etc/apt/sources.list.d/debian-unstable.list 执行更新：\napt update \u0026amp;\u0026amp; apt list --upgradable 安装微码，intel 选择：\napt -y install intel-microcode amd 选择：\napt -y install amd64-microcode 更新完之后重启，发现之前报告要求更新 microcode 的信息消失了，搞定。\n记得把 unstable 仓库删除，避免不小心更新到这个仓库中的其他软件。\nrm /etc/apt/sources.list.d/debian-unstable.list 引发问题 安装上面的方式安装微码之后，即使注释或者删除 debian-unstable.list 文件，在 apt update 时也会出现以下提示：\n$ apt update Hit:1 https://mirrors.ustc.edu.cn/debian bookworm InRelease Hit:2 https://mirrors.tuna.tsinghua.edu.cn/proxmox/debian bookworm InRelease Hit:3 https://mirrors.ustc.edu.cn/debian bookworm-updates InRelease Reading package lists... Done Building dependency tree... Done Reading state information... Done All packages are up to date. N: Repository 'Debian bookworm' changed its 'firmware component' value from 'non-free' to 'non-free-firmware' N: More information about this can be found online in the Release notes at: https://www.debian.org/releases/bookworm/amd64/release-notes/ch-information.html#non-free-split 如果不想继续看到这个提示，可以修改文件：\nvi /etc/apt/apt.conf.d/no-bookworm-firmware.conf 输入内容：\nAPT::Get::Update::SourceListWarnings::NonFreeFirmware \u0026quot;false\u0026quot;; 再次执行 apt update 命令就不会再出现这个提示了：\n$ apt update Hit:1 https://mirrors.ustc.edu.cn/debian bookworm InRelease Hit:2 https://mirrors.ustc.edu.cn/debian bookworm-updates InRelease Hit:3 https://mirrors.tuna.tsinghua.edu.cn/proxmox/debian bookworm InRelease Reading package lists... Done Building dependency tree... Done Reading state information... Done All packages are up to date. 参考资料 How to Install the Latest Microcode on Proxmox VE (Debian stable) ","date":"2024-08-21T00:00:00Z","permalink":"https://tflasp.fun/2024/microcode/","title":"【归档】Proxmox VE更新CPU微码"},{"content":"问题重现 发现更新驱动之后，普通模式下可以正常工作，但一旦开启直通，这个驱动就会无法工作。\n而因为 RTL8139 被加入黑名单，导致没有驱动可用，然后网卡就无法使用。\n因为这个网卡是用于管理网络的，所以 PVE 也跟着失联了\u0026hellip;\u0026hellip;\n因此，放弃更新这个驱动。后续移除了所有的 2.5G 网卡，统一使用 cx3 pro 40g （hp544+）或者 cx4 25g 网卡。\n准备工作 apt install -y dkms\rapt install -y pve-headers-$(uname -r)\rapt install --fix-broken\r下载驱动 https://github.com/awesometic/realtek-r8125-dkms/releases\nmkdir ~/temp\rcd ~/temp\rwget https://github.com/awesometic/realtek-r8125-dkms/releases/download/9.010.01-2/realtek-r8125-dkms_9.010.01-2_amd64.deb\r通过安装包安装驱动 dpkg -i realtek-r8125-dkms_9.010.01-2_amd64.deb\r输出为：\ndpkg -i realtek-r8125-dkms_9.010.01-2_amd64.deb\rSelecting previously unselected package realtek-r8125-dkms.\r(Reading database ... 86910 files and directories currently installed.)\rPreparing to unpack realtek-r8125-dkms_9.010.01-2_amd64.deb ...\rUnpacking realtek-r8125-dkms (9.010.01-2) ...\rSetting up realtek-r8125-dkms (9.010.01-2) ...\rlocale: Cannot set LC_ALL to default locale: No such file or directory\rLoading new realtek-r8125-9.010.01 DKMS files...\rDeprecated feature: REMAKE_INITRD (/usr/src/realtek-r8125-9.010.01/dkms.conf)\rBuilding for 6.2.16-4-pve\rBuilding for architecture amd64\rBuilding initial module for 6.2.16-4-pve\rDeprecated feature: REMAKE_INITRD (/var/lib/dkms/realtek-r8125/9.010.01/source/dkms.conf)\rDone.\rDeprecated feature: REMAKE_INITRD (/var/lib/dkms/realtek-r8125/9.010.01/source/dkms.conf)\rDeprecated feature: REMAKE_INITRD (/var/lib/dkms/realtek-r8125/9.010.01/source/dkms.conf)\rr8125.ko:\rRunning module version sanity check.\r- Original module\r- No original module exists within this kernel\r- Installation\r- Installing to /lib/modules/6.2.16-4-pve/updates/dkms/\rdepmod...\r这个版本是 9.010。\n通过源码安装驱动 发现代码里面有更新到 9.011，只是没有打包发布为 deb 格式。但是可以从源码开始安装。\ngit clone https://github.com/awesometic/realtek-r8125-dkms.git cd realtek-r8125-dkms\r./dkms-install.sh\r输出为：\n./dkms-install.sh About to run dkms install steps...\rDeprecated feature: REMAKE_INITRD (/usr/src/r8125-9.011.01/dkms.conf)\rCreating symlink /var/lib/dkms/r8125/9.011.01/source -\u0026gt; /usr/src/r8125-9.011.01\rSign command: /lib/modules/6.2.16-4-pve/build/scripts/sign-file\rSigning key: /var/lib/dkms/mok.key\rPublic certificate (MOK): /var/lib/dkms/mok.pub\rDeprecated feature: REMAKE_INITRD (/var/lib/dkms/r8125/9.011.01/source/dkms.conf)\rBuilding module:\rCleaning build area...\r'make' -j16 KVER=6.2.16-4-pve BSRC=/lib/modules/6.2.16-4-pve modules......\rSigning module /var/lib/dkms/r8125/9.011.01/build/src/r8125.ko\rCleaning build area...\rDeprecated feature: REMAKE_INITRD (/var/lib/dkms/r8125/9.011.01/source/dkms.conf)\rr8125.ko:\rRunning module version sanity check.\r- Original module\r- Installation\r- Installing to /lib/modules/6.2.16-4-pve/updates/dkms/\rdepmod...\rFinished running dkms install steps.\r更换驱动 屏蔽 R8169 驱动：\nsudo sh -c 'echo blacklist r8169 \u0026gt;\u0026gt; /etc/modprobe.d/blacklist_r8169.conf'\r重启机器，检验：\nlsmod | grep r81 r8125 262144 0\rr8169 114688 0\r对比没有更新驱动的输出：\nlsmod | grep r81 r8169 114688 0\r检验 更新之前，客户端和服务器端都使用默认的 r8169 驱动，iperf3 测试速度为 2.35-2.36G。\n更新客户端驱动为 r8125 驱动, iperf3 测试速度为 2.35-2.36 G，几乎没有变化。\n继续更新服务器端驱动为 r8125 驱动, iperf3 测试速度为 2.35/2.36G，几乎没有变化。\n总结：更新驱动未能带来速度方面的直接收益。\n参考资料 https://zhuanlan.zhihu.com/p/577161166 https://www.right.com.cn/forum/forum.php?mod=viewthread\u0026tid=7446026 https://github.com/awesometic/realtek-r8125-dkms ","date":"2024-08-21T00:00:00Z","permalink":"https://tflasp.fun/2024/rtl8125-driver/","title":"【归档】PVE安装RTL8125驱动"},{"content":"前面在安装 PVE 时，选择了留出 50G 大小的空间给 timeshift 使用。\n为 timeshift 准备分区 查看当前磁盘分区情况 fdisk -l\r查看当前硬盘情况：\nDisk /dev/nvme0n1: 465.76 GiB, 500107862016 bytes, 976773168 sectors\rDisk model: WDC WDS500G1B0C-00S6U0 Units: sectors of 1 * 512 = 512 bytes\rSector size (logical/physical): 512 bytes / 512 bytes\rI/O size (minimum/optimal): 512 bytes / 512 bytes\rDisklabel type: gpt\rDisk identifier: 000372CE-8B4D-4B12-974B-99C231DB3D67\rDevice Start End Sectors Size Type\r/dev/nvme0n1p1 34 2047 2014 1007K BIOS boot\r/dev/nvme0n1p2 2048 2099199 2097152 1G EFI System\r/dev/nvme0n1p3 2099200 838860800 836761601 399G Linux LVM\rDisk /dev/mapper/pve-swap: 8 GiB, 8589934592 bytes, 16777216 sectors\rUnits: sectors of 1 * 512 = 512 bytes\rSector size (logical/physical): 512 bytes / 512 bytes\rI/O size (minimum/optimal): 512 bytes / 512 bytes\rDisk /dev/mapper/pve-root: 96 GiB, 103079215104 bytes, 201326592 sectors\rUnits: sectors of 1 * 512 = 512 bytes\rSector size (logical/physical): 512 bytes / 512 bytes\rI/O size (minimum/optimal): 512 bytes / 512 bytes\r这是一个大小为 480G 的 nvme SSD 硬盘，实际可用空间为 465G。在安装 PVE 时我将 hdsize 设置为 400G, 因此 PVE 使用的空间只有400G。从上面输出可以看到：\n/dev/nvme0n1p1 34 2047 2014 1007K BIOS boot\r/dev/nvme0n1p2 2048 2099199 2097152 1G EFI System\r/dev/nvme0n1p3 2099200 838860800 836761601 399G Linux LVM\rnvme0n1p1 是 BIOS， nvme0n1p2 是 EFI 分区，PVE 使用的是 nvme0n1p3，399G。\n另外可以看到：\nDisk /dev/mapper/pve-swap: 8 GiB, 8589934592 bytes, 16777216 sectors\rDisk /dev/mapper/pve-root: 96 GiB, 103079215104 bytes, 201326592 sectors\rswap 使用了 8G， pve root 使用了 96 G。\nlsblk -f\r可以看到 nvme0n1p3 是一个 LVM2，400G 的总空间中，内部被分为 pve-swap / pve-root / pve-data_tmeta\nNAME FSTYPE FSVER LABEL UUID FSAVAIL FSUSE% MOUNTPOINTS\rnvme0n1 |-nvme0n1p1 |-nvme0n1p2 vfat FAT32 26F2-091E 1021.6M 0% /boot/efi\r`-nvme0n1p3 LVM2_member LVM2 001 foXyBZ-IPQT-wOCF-DWSN-u88a-sBVD-LaZ9zn |-pve-swap swap 1 c5d97cb5-4d18-4f43-a36f-fb67eb8dcc84 [SWAP]\r|-pve-root ext4 1.0 a0a46add-dda5-42b4-a978-97d363eeddd0 85.2G 4% /\r|-pve-data_tmeta | `-pve-data `-pve-data_tdata `-pve-data 剩余的大约 60G 的空间在这里没有显示。\n添加 timeshift 分区 fdisk /dev/nvme0n1\r输出为：\nWelcome to fdisk (util-linux 2.38.1).\rChanges will remain in memory only, until you decide to write them.\rBe careful before using the write command.\rThis disk is currently in use - repartitioning is probably a bad idea.\rIt's recommended to umount all file systems, and swapoff all swap\rpartitions on this disk.\r在警告说磁盘使用中，重新分区不是一个好注意。不过我们是操作剩余空间，比较安全。\n输入 m 获得帮助：\nCommand (m for help): m\rHelp:\rGPT\rM enter protective/hybrid MBR\rGeneric\rd delete a partition\rF list free unpartitioned space\rl list known partition types\rn add a new partition\rp print the partition table\rt change a partition type\rv verify the partition table\ri print information about a partition\rMisc\rm print this menu\rx extra functionality (experts only)\rScript\rI load disk layout from sfdisk script file\rO dump disk layout to sfdisk script file\rSave \u0026amp; Exit\rw write table to disk and exit\rq quit without saving changes\rCreate a new label\rg create a new empty GPT partition table\rG create a new empty SGI (IRIX) partition table\ro create a new empty MBR (DOS) partition table\rs create a new empty Sun partition table\r输入 F 列出未分区的剩余空间：\nCommand (m for help): F\rUnpartitioned space /dev/nvme0n1: 65.76 GiB, 70610066944 bytes, 137910287 sectors\rUnits: sectors of 1 * 512 = 512 bytes\rSector size (logical/physical): 512 bytes / 512 bytes\rStart End Sectors Size\r838862848 976773134 137910287 65.8G\r这个 65.8G 就是我们之前预留的空间。\n输入 n 添加新的分区，默认是利用剩余空间的全部。这里敲三次回车全部默认即可。\nCommand (m for help): n\rPartition number (4-128, default 4): First sector (838860801-976773134, default 838862848): Last sector, +/-sectors or +/-size{K,M,G,T,P} (838862848-976773134, default 976773119): Created a new partition 4 of type 'Linux filesystem' and of size 65.8 GiB.\r如果不是利用全部剩余空间，则可以通过输入 +100G 这样的内容来设置要添加的分区大小。\n输入 p 显示修改之后的分区表：\nCommand (m for help): p\rDisk /dev/nvme0n1: 465.76 GiB, 500107862016 bytes, 976773168 sectors\rDisk model: WDC WDS500G1B0C-00S6U0 Units: sectors of 1 * 512 = 512 bytes\rSector size (logical/physical): 512 bytes / 512 bytes\rI/O size (minimum/optimal): 512 bytes / 512 bytes\rDisklabel type: gpt\rDisk identifier: 000372CE-8B4D-4B12-974B-99C231DB3D67\rDevice Start End Sectors Size Type\r/dev/nvme0n1p1 34 2047 2014 1007K BIOS boot\r/dev/nvme0n1p2 2048 2099199 2097152 1G EFI System\r/dev/nvme0n1p3 2099200 838860800 836761601 399G Linux LVM\r/dev/nvme0n1p4 838862848 976773119 137910272 65.8G Linux filesystem\r可以看到我们新加的 nvme0n1p4 分区大小为 65.8G。\n检查无误，输入 w 写入修改操作并退出。\nCommand (m for help): w\rThe partition table has been altered.\rSyncing disks.\r在 pve 下执行\nfdisk -l 再次检查分区情况：\n......\rDevice Start End Sectors Size Type\r/dev/nvme0n1p1 34 2047 2014 1007K BIOS boot\r/dev/nvme0n1p2 2048 2099199 2097152 1G EFI System\r/dev/nvme0n1p3 2099200 838860800 836761601 399G Linux LVM\r/dev/nvme0n1p4 838862848 976773119 137910272 65.8G Linux filesystem\r至此 timeshift 分区准备OK.\n格式化 timeshift 分区 mkfs.ext4 /dev/nvme0n1p4\r对分区进行格式化，格式为 ext4：\nmke2fs 1.47.0 (5-Feb-2023)\rDiscarding device blocks: done Creating filesystem with 17238784 4k blocks and 4317184 inodes\rFilesystem UUID: 2411eb4e-67f1-4c7d-b633-17df1fa0c127\rSuperblock backups stored on blocks: 32768, 98304, 163840, 229376, 294912, 819200, 884736, 1605632, 2654208, 4096000, 7962624, 11239424\rAllocating group tables: done Writing inode tables: done Creating journal (131072 blocks): done\rWriting superblocks and filesystem accounting information: done 安装 timeshift 具体参考这里：\nhttps://skyao.io/learning-ubuntu-server/docs/installation/timeshift/install/\n安装配置完成后，执行\ntimeshift --list\r查看 timeshift 情况：\nFirst run mode (config file not found)\rSelected default snapshot type: RSYNC\rMounted '/dev/nvme0n1p4' at '/run/timeshift/5364/backup'\rDevice : /dev/nvme0n1p4\rUUID : 2411eb4e-67f1-4c7d-b633-17df1fa0c127\rPath : /run/timeshift/5364/backup\rMode : RSYNC\rStatus : No snapshots on this device\rFirst snapshot requires: 0 B\rNo snapshots found\r使用 timeshift 进行备份 设置自动备份 vi /etc/timeshift/timeshift.json\r打开 timeshift 配置文件，修改以下内容\n{\r\u0026quot;schedule_monthly\u0026quot; : \u0026quot;true\u0026quot;,\r\u0026quot;schedule_weekly\u0026quot; : \u0026quot;true\u0026quot;,\r\u0026quot;schedule_daily\u0026quot; : \u0026quot;true\u0026quot;,\r\u0026quot;schedule_hourly\u0026quot; : \u0026quot;false\u0026quot;,\r\u0026quot;schedule_boot\u0026quot; : \u0026quot;false\u0026quot;,\r\u0026quot;count_monthly\u0026quot; : \u0026quot;2\u0026quot;,\r\u0026quot;count_weekly\u0026quot; : \u0026quot;3\u0026quot;,\r\u0026quot;count_daily\u0026quot; : \u0026quot;5\u0026quot;,\r\u0026quot;count_hourly\u0026quot; : \u0026quot;6\u0026quot;,\r\u0026quot;count_boot\u0026quot; : \u0026quot;5\u0026quot;,\r}\r对于软路由机器，由于是长期开机并且改动不过，因此 schedule_monthly / schedule_weekly / schedule_daily 设置为 true，数量用默认值。\n排除不需要备份的内容 默认情况下 timeshift 的配置文件中已经设置了 exclude：\n{\r\u0026quot;exclude\u0026quot; : [\r\u0026quot;/var/lib/ceph/**\u0026quot;,\r\u0026quot;/root/**\u0026quot;\r],\r\u0026quot;exclude-apps\u0026quot; : []\r}\r/var/lib/ceph/： ceph 相关的文件\n/root/: root 用户的 home 路径，如果使用其他用户，也需要将它们的 home 目录加入进来。\n但这些是不够的，还需要增加以下内容：\n/var/lib/vz/\npve的各种文件，包括虚拟机，模版，备份，上传的iso文件等都在这里，这些文件太大，不适合用 timeshift 备份，因此必须排除。\nls /var/lib/vz\rdump images private snippets template\rdump： 这里保存 pve backup 备份下来的虚拟机镜像文件 images： 这里保存 pve 虚拟机镜像文件 template： iso 子目录中保存的是上传到 pve 的各种 iso/img 文件 /etc/pve/qemu-server/: pve 的虚拟机配置文件，这些文件也不要用 timeshift 备份，避免恢复时把虚拟机文件也给覆盖了。虚拟机文件的备份会由下一节中提到的自动脚本进行备份。\n/mnt/pve: 在 pve 下使用 nfs 存储时，远程 nfs 会自动 mount 到这个目录下，这些文件肯定也不能被 timeshift 备份。因此必须排除。\n最后通过设置的 exclude 为：\n{\r......\r\u0026quot;exclude\u0026quot; : [\r\u0026quot;/var/lib/ceph/**\u0026quot;,\r\u0026quot;/root/**\u0026quot;,\r\u0026quot;/var/lib/vz/**\u0026quot;,\r\u0026quot;/etc/pve/qemu-server/**\u0026quot;,\r\u0026quot;/mnt/pve/**\u0026quot;\r],\r}\r设置自动备份虚拟机文件 见下一章，推荐完成这个操作之后再执行手工备份。\n手工备份 timeshift --create --comments \u0026quot;first backup after apt upgrade and basic soft install\u0026quot;\r输入为：\nEstimating system size...\rCreating new snapshot...(RSYNC)\rSaving to device: /dev/nvme0n1p4, mounted at path: /run/timeshift/6888/backup\rSyncing files with rsync...\rCreated control file: /run/timeshift/6888/backup/timeshift/snapshots/2023-07-25_21-10-04/info.json\rRSYNC Snapshot saved successfully (41s)\rTagged snapshot '2023-07-25_21-10-04': ondemand\r------------------------------------------------------------------------------\r查看当前备份情况：\ntimeshift --list Mounted '/dev/nvme0n1p4' at '/run/timeshift/7219/backup'\rDevice : /dev/nvme0n1p4\rUUID : 2411eb4e-67f1-4c7d-b633-17df1fa0c127\rPath : /run/timeshift/7219/backup\rMode : RSYNC\rStatus : OK\r1 snapshots, 64.5 GB free\rNum Name Tags Description ------------------------------------------------------------------------------\r0 \u0026gt; 2023-07-25_21-10-04 O first backup after apt upgrade and basic soft install 结合备份之前看到的 timeshift 备份分区的大小为 65.8G，减去这里的 64.5 GB free，也就是这个备份用掉了 1.3 G 的磁盘空间。\n","date":"2024-08-21T00:00:00Z","permalink":"https://tflasp.fun/2024/timeshift/","title":"【归档】PVE安装配置timeshift"},{"content":"问题复现 爱国者P7000Z（以及所有使用MAXIO 1602主控的PCIe4.0固态）有个坑，两块以上只认一块。 经分析发现，是联芸MAP1602主控的共性问题。 给官方Linux内核提出了patch，内核6.4版本开始会集成进来。\n解决方法 diff --git a/drivers/nvme/host/pci.c b/drivers/nvme/host/pci.c\r--- a/drivers/nvme/host/pci.c\r+++ b/drivers/nvme/host/pci.c\r@@ -3424,6 +3424,8 @@ static const struct pci_device_id nvme_id_table[] = {\r.driver_data = NVME_QUIRK_BOGUS_NID, },\r{ PCI_DEVICE(0x1e4B, 0x1202), /* MAXIO MAP1202 */\r.driver_data = NVME_QUIRK_BOGUS_NID, },\r+ { PCI_DEVICE(0x1e4B, 0x1602), /* MAXIO MAP1602 */\r+ .driver_data = NVME_QUIRK_BOGUS_NID, },\r{ PCI_DEVICE(0x1cc1, 0x5350), /* ADATA XPG GAMMIX S50 */\r.driver_data = NVME_QUIRK_BOGUS_NID, },\r{ PCI_DEVICE(0x1dbe, 0x5236), /* ADATA XPG GAMMIX S70 */\rPVE 8.0 beta最新，内核是6.2.16-1-pve，所以目前不支持联芸MAP1602主控的多块NVMe同时使用。 现在需要使用的，修改不难， 下载源码，找到代码中drivers/nvme/host/pci.c添加这两行\n{ PCI_DEVICE(0x1e4B, 0x1602), /* MAXIO MAP1602 */\r.driver_data = NVME_QUIRK_BOGUS_NID, },\r重新编译安装，就好了。\n20230616 分享编译好的内核，直接用就好，基于PVE 8.0beta源码6.2.16-1修改： 链接: https://pan.baidu.com/s/1qdF8AVyjUOX_gL8Fxe9g6A?pwd=CHH1 提取码: CHH1\n20230708 分享编译好的内核，直接用就好，基于PVE 8.0正式版源码6.2.16-3修改： 链接: https://pan.baidu.com/s/1juvlOR6uA7G53eiCJTAzGw?pwd=CHH2\n20230712 分享编译好的内核，直接用就好，基于PVE 8.0正式版源码6.2.16-4修改： 链接: https://pan.baidu.com/s/1xHShA5LBaVl2uWH4cIUHGg?pwd=CHH3 提取码: CHH3\n20230713 分享基于PVE 8.0正式版源码6.2.16-4修改的4TB未验证测试版，按114楼增加了延时属性。 链接: https://pan.baidu.com/s/1Wgbva1awvubtBFdxhx0vaA?pwd=CHH4 提取码: CHH4\n20230908 分享基于PVE 8.0正式版源码6.2.16-12修改的4TB未验证测试版，增加延时属性及初始化延迟。 链接: https://pan.baidu.com/s/1D-0qjzBop9d_tOcRu7bs3Q?pwd=CHH5 提取码: CHH5\n安装方法： 上传文件至PVE，登录PVE执行：\ndpkg -i *.deb\r重启即可。\n参考资料 ChipHell\n","date":"2024-08-21T00:00:00Z","permalink":"https://tflasp.fun/2024/pve-maxio1602/","title":"【归档】PVE环境下硬盘识别问题"},{"content":"问题重现 有时在经过错误的配置之后，pve 系统会无法使用，甚至无法进入系统和页面控制台。\n此时需要有其他的方案来修复系统。\n恢复模式 进入恢复模式 开机，选择 \u0026ldquo;Advanced options for Proxmox VE GNU/Linux\u0026rdquo; ，然后选择 Rescue mode。\n用 root 密码登录即可。\n启动集群 systemctl start pve-cluster\r这是就可以访问目录 /etc/pve 来操作集群和虚拟机了。\n操作虚拟机 比如关闭有问题的虚拟机：\nqm stop id\r修改虚拟机配置 cd /etc/pve/nodes/\u0026lt;node_name\u0026gt;/qume-server\r这里能看到各个虚拟机的配置文件，打开相应的配置文件修改即可，比如取消虚拟机的开机，只要将 onboot 修改为 0.\n","date":"2024-08-21T00:00:00Z","permalink":"https://tflasp.fun/2024/pve-recovery/","title":"【归档】PVE进入Recovery模式恢复系统"},{"content":"存储系统 RAM RAM（随机访问存储器）： RAM 是计算机中用于临时存储数据和程序的一种类型的存储器。它是一种易失性存储器，意味着当计算机断电或重新启动时，RAM 中的数据将会丢失。RAM 具有高速读写的特性，因此在计算机中被广泛用于存储运行中的程序和正在处理的数据。在计算机运行时，操作系统和应用程序会将需要快速访问的数据和指令加载到 RAM 中，以便 CPU 能够快速地读取和处理它们。RAM 的容量通常以 GB（Gigabytes）为单位，如 4GB、8GB、16GB 等。\n主存储器（主内存）： 主存储器指的是计算机中的 RAM，用于存储正在运行的程序和数据。CPU 可以直接访问主存储器中的数据，因此它是计算机中最快速的存储器类型。\n辅助存储器(ROM)： 辅助存储器指的是计算机中的非易失性存储设备，如硬盘、SSD、SD 卡等。它们的存储速度相对较慢，但可以长期保存数据，即使计算机断电也不会丢失数据。辅助存储器主要用于长期存储和备份数据，以及安装操作系统和应用程序。\nSRAM与DRAM 类型 作用 特点 SRAM（Static Random Access Memory，静态随机存储器） 它是一种具有静止存取功能的内存，不需要刷新电路即能保存它内部存储的数据 优点是速度快，不必配合内存刷新电路，可提高整体的工作效率。缺点是集成度低，功耗较大，相同的容量体积较大，而且价格较高，少量用于关键性系统以提高效率。 DRAM（Dynamic Random Access Memory，动态随机存储器) DRAM只能将数据保持很短的时间。为了保持数据，DRAM使用电容存储，所以必须隔一段时间刷新（refresh）一次，如果存储单元没有被刷新，存储的信息就会丢失 必须刷新，后面衍生出DDR，DDR2，DDR3，DDR4，DDR5 DDR基础 我们常说的DDR，亦即DDR SDRAM，指的是PC端或者消费电子（手机，平板）中的内存，是 “Double Data Rate Synchronous Dynamic Random Access Memory”（双数据率同步动态随机存储器）的简称，它 允许在时钟脉冲的上升沿和下降沿传输数据，其主要作用是为了和CPU频率同步，进而大大提高数据传输效率。 SDRAM从发展到现在已经经历了五代，分别是：\n第一代SDR SDRAM，单边沿传输数据；\r第二代DDR SDRAM，允许在时钟脉冲的上升沿和下降沿传输数据；\r第三代DDR2 SDRAM，拥有两倍于上一代DDR内存预读取能力(即4bit数据读预取能力)；\r第四代DDR3 SDRAM，具备更低的工作电压(1.5v)，240线接口，支持8bit预读；\r第五代DDR4 SDRAM，16bit预取机制（DDR3为8bit），同样内核频率下理论速度是DDR3的两倍，；\r目前已经发展到DDR5 SDRAM；\rDDR1-5各代实物图对比 DDR核心技术点就在于：（1）双沿传输。（2）预取prefetch。 DDR的频率：（1）核心频率、（2）时钟频率、（3）数据传输频率；核心频率就是内存的工作频率；DDR1内存的核心频率是和时钟频率相同的，到了DDR2和DDR3时才有了时钟频率的概念，就是将核心频率通过倍频技术得到的一个频率。数据传输频率就是传输数据的频率。DDR1预读取是2位，DDR2预读取是4位，DDR3预读取是8位…\n与DDR相比，LPDDR内存全称是Low Power Double Data Rate SDRAM，中文意为低功耗双倍数据速率内存，又称为mDDR（Mobile DDR SDRM），主要针对于移动端电子产品。 LPDDR4X可以看作是LPDDR4的省电优化版本，比LPDDR4功耗更低、更省电；目前市面上主流旗舰手机内存使用的都是LPDDR4X和LPDDR4，由于二者经常同时出现，名字也十分相似，所以很容易让人混淆。\nECC、None-ECC与REG-ECC ECC，全称 Error Correction Code，是一种可以自动检测并修复数据错误的类型的计算机数据存储。ECC 内存在存储数据时会生成校验码，当数据被重新读取时，它会使用这些校验码来检查是否有错误发生。如果检测到错误，ECC 内存会尝试自动修复这些错误，或者至少通知系统错误已经发生。\n1.1 工作原理 ECC内存通过奇偶校验或更复杂的纠错码来检测和纠正内存中的数据错误。\n1、奇偶校验位： 奇偶校验是一种简单的错误检测方法，它通过在数据字节末尾添加一个额外的位（奇校验位或偶校验位）来检测错误。根据校验位的设置，数据字节的总位数可以是奇数或偶数。例如，如果校验位设置为使数据字节的总位数为奇数，那么校验位将被设置为确保总位数为奇数。如果在数据传输过程中发生了错误，奇偶校验位将不匹配，从而指示出现错误。\n2、纠错码： 纠错码通常更复杂，可以检测和纠正多个位的错误。ECC内存使用纠错码，如Hamming码或其他类似的编码方案，生成校验位。这些校验位用于检测和纠正内存中的数据错误。例如，Hamming码可以纠正单个位错误，以及检测多位错误。\n3、错误检测和纠正： 当数据从内存中读取时，内存控制器会计算校验位并与存储的校验位进行比较。如果检测到校验位不匹配，内存控制器将确定发生了错误，并尝试纠正错误（如果支持）。这使ECC内存能够在读取数据时检测到单个位错误并进行纠正，以确保数据的完整性。\n4、纠错能力： 纠错码的能力取决于其设计和级别。某些ECC内存可以纠正单个位错误，而其他更高级别的ECC内存可以纠正多个位错误。\n1.2 特点 1、错误检测和纠正： ECC内存使用附加的校验位来检测并纠正内存中的单个位错误。这意味着即使在内存硬件出现故障的情况下，服务器仍然可以正常运行。\n2、数据完整性： ECC内存可确保存储在内存中的数据的完整性，因此在关键任务和数据中使用它可以防止数据损坏。\n3、可靠性： 由于其纠正能力，ECC内存在服务器环境中非常可靠，可以减少因内存故障而导致的服务器停机时间。\n4、成本： 由于其高级功能，ECC内存通常比非ECC内存更昂贵。\n1.3适用场景 1、关键任务和数据： 对于需要高度可靠性和数据完整性的服务器，如金融机构、医疗保健、科学计算等，ECC内存是必不可少的选择。它可以检测并纠正内存中的单个位错误，防止数据损坏。\n2、大规模服务器： 在大规模数据中心环境中，单个位错误可能会发生，ECC内存有助于防止这些错误对整个系统的影响。\n3、虚拟化： 虚拟化环境中，多个虚拟机共享同一台物理服务器的内存。ECC内存可以减少虚拟机之间的内存冲突和数据错误。\n4、长时间运行： 如果您的服务器需要长时间运行，ECC内存有助于减少内存错误导致的系统崩溃的风险。\nNone-ECC 内存 2.1 特点 1、性能： 由于不需要额外的校验计算，非ECC内存通常比ECC内存具有稍微更高的性能。\n2、成本： 非ECC内存相对便宜，适用于预算有限的服务器。\n2.2 适用场景 非ECC内存通常更适合一些性能密集型的应用和成本敏感型的环境，包括：\n1、Web服务器： 对于大多数Web服务器，性能可能比数据完整性更重要。非ECC内存提供了更高的性能，并且通常更经济实惠。\n2、游戏服务器： 在游戏服务器中，快速响应时间和较低的延迟可能更加关键，而非ECC内存通常具备更高的性能。\n3、一般用途服务器： 对于一般用途的服务器，非ECC内存可能足够，因为数据完整性不是最重要的考虑因素。\n4、预算受限： 如果您的预算有限，非ECC内存通常更经济实惠。\n","date":"2024-08-19T00:00:00Z","image":"https://img.picui.cn/free/2024/08/19/66c31be1e7277.jpg","permalink":"https://tflasp.fun/2024/intoram/","title":"RAM"},{"content":"SSD开卡技术 SSD（固态硬盘）里采用慧荣主控的品牌很多，其中常见的慧荣主控型号有SM2258XT、SM2259XT、SM2259XT2、SM2259XT3、SM2263XT等等，这些主控的SSD要是坏了或者掉盘了，在保质期里的可以返厂维修，如果过保了，我们还是有办法自己修复的，方法就是用量产软件来开卡。\n准备工作 准备SM2258XT开卡软件，找长方形的闪存颗粒，打开量产部落的闪存查询（或者FlashID官网）查询闪存ID与制程，输入闪存颗粒上面的编号来确定制程（黑片、打标片除外），然后再从量产部落上面下载开卡软件。\n准备一个SATA-USB转接硬盘盒（建议使用ASM1153E/JMS578主控的），把SSD插到硬盘盒里，用尖头镊子短接SSD的ROM孔，保持短接，把硬盘盒插到电脑USB接口上（固态U盘可以直接短接ROM，再插电脑USB即可）。\n开卡流程 打开开卡软件，点击右侧“搜索设备”，待软件识别到SSD后，把尖头镊子取下。\n点击“1024M”，查看ID显示是否正常，有无缺失（如下图，是Channel3的CE0错误），CE错误的原因可能是颗粒损坏、主控损坏、主板损坏、焊接不良等等，一一排除直到正确显示。\n进入“设定”页面，点击右上角“编辑配置”，输入密码（两个空格），此时软件会解锁，我们可以对配置信息进行修改。\n点击“自动”，软件会自动识别SSD的颗粒型号，一般选择第一个。\n下图中可以编辑SSD的产品名称、序列号等等。\n下图可以设置SSD容量，自动或者手动都行，我一般用Auto自动。\nSSD类型与功能，一般默认即可。\n设置颗粒速度，可根据颗粒情况调节快慢，颗粒质量差需要降低频率，类似于超频的思路，自己尝试即可。\n下图选择量产模式，一般情况下“Pretest”选择1；多个不同等级颗粒一起量产时，可勾选“忽略区分等级”（开启“忽略区分等级”功能）；“CH/CE组态”可以选择颗粒的某个CE量产（譬如4CE的颗粒坏掉1个CE，可以选择只量产另外2个对称CE，这样就能量产出一半的容量，具体可自测）；部分颗粒量产可能报TranADJ错误，此时需要勾选“忽略Tran ADJ”。\nRDT RDT测试，不勾选“RDT测试”即表示正常ISP开卡，开卡后重新拔插SSD再分区即可正常使用。勾选“RDT测试”相当于写入数据，再读取校验，用来标记坏块。下图左侧是正常ISP开卡，右侧是RDT测试开卡。\n勾选“RDT测试”后，右边的“RDT设定”按钮即可启用，进行RDT相关设置（可参考下图）。\n保存设置后点击“开始”按钮进行RDT量产。量产成功后，再把SSD/固态U盘通过硬盘盒或者转接线插到电源上（部分可使用充电头）会自动进行测试，RDT测试时间大约为N个小时（512GB的SSD一般要1.5个小时）。\nRDT结束后可通过下图查看RDT结果，显示RDT PASS则为正常，如未通过可能是颗粒损坏严重。\n需要注意的是，RDT结束后仍需要进行一次ISP开卡，如下图在“Pretest”里可选择3（参考RDT坏块量产），并且不再勾选“RDT测试”，这样量产出的SSD已经屏蔽了坏块，使用起来相对稳定。\n总结 总之最后都要不勾选“RDT测试”，进行ISP开卡才能使SSD正常使用。保存设置，回到“开卡”页面，点击“开始”，等待量产成功。量产成功后，需要重新插一下硬盘盒，对SSD进行分区格式化。\n","date":"2024-08-11T00:00:00Z","image":"https://tflasp.fun/2024/ssd-fw/SSDFW-MAIN_hu0e0cb618b8fd3ce0fb65d459aa58a52e_143118_120x120_fill_q75_box_smart1.jpg","permalink":"https://tflasp.fun/2024/ssd-fw/","title":"SSD开卡"},{"content":"SSD简介 SSD (Solid State Drive)，即固态硬盘，是一种以半导体闪存(NAND Flash)作为介质的存储设备。和传统机械硬盘(Hard Disk Drive，HDD)不同，SSD以半导体存储数据，用纯电子电路实现，没有任何机械设备，这就决定了它在性能、功耗、可靠性等方面和HDD有很大不同。\nSSD 协议与接口 PCIe协议 PCIe带宽 PCIe GEN1在链路上的传输速率为2.5Gb/s。PCIe在GEN1和GEN2采用了8b/10b编码方式，也就是说链路上传输10b数据，实际传输的有效数据只有8b。对于GEN1 x1的PCIe链路，传输的有效带宽为：\n2.5Gb/s * 2 * 8b/10b * B/8b = 0.5GB/s\r2代表TX和RX\nPCIe拓扑结构 PCIe主要的组件有RC（Root Complex），SW（Switch），EP（Endpoint）。RC可以和所有device进行通信，一个EP也可以和一个PCIe系统中的EP来通信（Peer-to-Peer）。协议规定SW需要支持Peer-to-Peer，但对于有多个port的RC并没有要求。也就是说下图中 PCIe4 和 PCIe5 可以进行数据通信，但 PCIe4 和 PCIe6 就不一定能进行数据传输。\nRC是指连接CPU和存储器子系统以及PCIe结构的设备，可以支持一个或多个PCIe Port，下图中RC支持3个PCIe Port，每个Port连接EP或者SW，SW形成一个子层，又可以挂接其他PCIe设备。\nRC上的port可以进行数据交互，但协议并没有规定必须支持。\nSW是PCIe链路上进行转接的一类设备，拥有一个upstream prot和多个downstream port。可以将SW当作多个PCIe桥组成的设备。\nEP是PCIe链路的末端，有两种类型：Legacy Endpoint 和 PCIe Endpoint。传统EP支持IO事务，而且还需要能接收锁定事务。而PCIe EP不必支持IO事务和接收锁定事务，但必须支持MSI中断。\nupstream port：在一个PCIe 设备上靠近RC方向的port。\rdownstream port：在一个PCIe 设别上远离RC方向的port。\rIngress port（入端口）：接收数据包的端口。\rEgress port（出端口）：发送数据包的端口。\r在一个PCIe系统中，upstream port 和 downstream port是固定的，但是Ingress port 和 Egress port 是不固定的，和数据包的传输方向相关。例如：图中RC发起 MWr 事务到PCI-XP 4，那么SW上的upstream就是Ingress port，downstream就是Egress port。而当PCI-XP4发起 MWr到 RC时，那么SW的downstream就是 Ingress port，upstream就是 Egress port。\nPCIe Transaction 事务：Transaction指 requester 和 completer 之间完成一次信息传送时所需要完成的一系列或多个数据包传送的过程。\nPCIe支持的事务类型与PCI、PCI-X支持的事务类型相同，包括存储器读和存储器写，IO读和IO写，配置读和配置写，此外还增加了一种新事务：消息（message）。\nPCIe事务可以分为Non-Posted 和 Posted。Non-Posted指 requester 发送TLP请求包给completer时，completer需要返回一个TLP完成数据包给requester。Posted指requester 发送TLP请求事务包给 completer时，completer不需要回复TLP完成数据包给requester。\nPCIe的数据传输以数据包的形式进行传输，通信涉及一种称为处理层数据包（Transaction Layer packet， TLP）的数据包发送和接收。TLP包可以分为TLP请求的数据包和TLP完成的数据包。TLP请求的数据包依据PCIe事务的不同而不同，对于Non-Posted事务，需要completer 返回 TLP完成包给requester。TLP完成包带数据信息的称为CPLD，不带数据信息的称为CPL。\n更为具体的PCIe协议细节在此就不再赘述了，感兴趣可以在网上搜索更多技术细节\nNVMe介绍 NVMe综述 非易失性内存表达（Non-Volatile Memory Express，NVMe）是一种通过 PCI Express 接口访问非易失性存储设备（如固态硬盘）的技术。相较于使用 SATA 接口和 AHCI 标准的传统机械硬盘（HDD），NVMe 的数据访问速度获得了极大提升。NVMe 技术正是为了利用 PCI Express 的高带宽、低延迟等优势而开发的。以往 PCI Express 接口主要应用在显卡、声卡等扩展卡上，现在也应用到了高速存储接口上。\n在 NVMe 驱动器面市之前，SSD 和 HDD 基本都使用 SATA 接口。但是，SATA 通信标准自身的性能瓶颈局限着 SSD 的发展空间，因此迫切需要一种新的接口标准。最初，开发者通过直接将 SSD 插在 PCI Express 插槽上来绕过这一瓶颈，但这种做法并不符合标准规范。\nNVMe 为所有制造商提供了一个统一的标准。现在，大多数现代 NVMe SSD 都采用了 M.2 接口规格，而 M.2 接口有多种尺寸规格。\nM.2 B\u0026amp;M Key 当然，除了消费级SSD,企业级SSD通常采用另一些接口来满足生产环境的需求，比如U.2、E1.S、E1.L、E3.S、E3.L等等规格。\n配套的还有主板上对应的接口，图中包含了U.2（SFF8639）、SATA以及eSATA接口。\n以下是一个不是很完全的总结：\nSSD 主控与闪存 SATA SSD主控板实例：\n主控概述 NAND Flash概述 (该区域转载自这里)\nNAND 闪存的数据存储方法\nNAND 闪存是一种通过在氮化硅的内部补集点捕获电子或空穴来存储信息的设备。在这种设备中，工作区和栅极间会留有通道供电流通过硅晶片表面，而根据浮置栅极中存储的电荷类型，便可进行存储编程 (“1”) 和擦除 (“0”) 信息的操作。同时，在一个单元内存储 1 个比特的操作被称为单层单元 (SLC)。氮化硅内部捕获的电子数量与单元晶体管的阈值电压成正比，因此，当俘获大量电子时，即实现了高阈值电压；捕获少量电子会造成低阈值电压。\n通过将捕获的电子数量分成三份，并将每份的中间电压施加到单元栅极上，可以检查电流的流通状态，从而确定所捕获的电子数量。在这种情况下，存在四种状态，其中包括擦除状态：这就是 2 比特多层单元 (2 bit-MLC)。2 比特多层单元的这四种状态可以描述为“11”、“10”、“01”和“00”，每个单元可以存储 2 个比特的信息。从定义而言，多层单元指的是一种状态，在这种状态下，一个单元具有多层的 2 个比特或更多比特；然而在本文中，多层单元是相对于单层单元（SLC，Single Level Cell）（ 而言的。方便起见，本文将存储 2 个比特信息的多层单元（MLC，Multi Level Cell）称为 2 比特多层单元。\n在相同的方法下，若产生八单元状态并存储 3 个比特的信息时，此类状态则被称为三层单元 (TLC，Triple Level Cell)；同样，当产生十六单元状态并存储 4 个比特的信息时，则称为四层单元 (QLC, Quadruple Level Cell)。单元状态越密集，一个单元内便可储存更多信息。举例来说，与单层单元(SLC) NAND 闪存相比，四层单元(QLC) NAND 闪存能够以 67.5% 的芯片尺寸存储相同数量的信息；但若想进行更多运行和读取的操作，就要增大单元状态的密度。相应地，由于单元状态之间的空间狭窄，更大的密度会使性能降级并出现读取错误的可能性，从而导致设备寿命缩短。因此，重要的是，首先要根据NAND闪存的应用领域决定是否优先考虑信息量，性能和寿命，然后选择适当的编程方法。\n3D/4D-NAND 与 NAND 闪存行业的发展趋势 当前，NAND 闪存正在从 2D 发展到 3D 和 4D。对于 2D-NAND，如果在同一区域实现更多的单元数量，形成更小的工作区和栅级，便能增大存储容量。直至 2010 年初，2D-NAND 中的扩展一直是这项技术的主要焦点所在；然而，由于精细图案结构的限制，且储存数据会随时间推移而丢失导致使用寿命缩短，该技术已无法再实现扩展。因此，3D-NAND逐渐取而代之，成为业界关注焦点，现在所有 NAND 制造商都在开发和制造 3D-NAND 产品。\n在 3D-NAND 的结构中，存储容量会随着三维叠层中堆叠层数的增加而变大。3D-NAND 使用了堆叠多层氮氧化物的方法，形成一个被称为“塞子”的垂直深孔，在其中形成一个由氧化物-氮化物-氧化物制成的存储设备。通过这种方法，仅需少量工艺即可同时形成大量单元。在 3D-NAND 中，电流通过位于圆柱单元中心的多晶硅通道，便能根据存储在氮化硅中的电荷类型实现存储编程和擦除信息。虽然2D-NAND 技术发展的目标是实现形成较小的单元， 3D-NAND 的核心技术却是实现更多层数的三维堆叠。\n近年来，为了在 3D-NAND 的基础上进一步增大存储容量，SK 海力士开发了 4D-NAND技术，使得芯片尺寸进一步缩小。4D-NAND 在 3D-NAND 单元下方形成外围电路，减少了外围电路所占的面积，从而实现存储容量的最大化并降低 NAND 闪存的成本。经过几代技术的发展，当前的半导体行业已实现了用更多层数存储更多信息，包括 SK 海力士在内的业界领先企业完成了多达 128 层的产品开发和投产准备，甚至正在研发更多层的产品设备。\nNAND Flash 数据存储单元整体架构 NAND Flash 数据存储单元整体架构 NAND Flash 命名规则（部分） NAND Flash 封装 随着目前产品小型化的需求越来越多，且可穿戴设备的逐渐普及，工程师们对于芯片小型化的需求也越来越强烈，这个就涉及到了芯片的封装工艺。这次，我们只针对NAND flash的封装进行介绍。\n芯片常用封装有：DIP、QFP、PFP、PGA、BGA、TSOP、COB等封装。这里主要介绍NAND FLASH常用的三种封装（TSOP、BGA、COB）。\n1、TSOP封装\nTSOP是“Thin Small Outline Package”的缩写，意思是薄型小尺寸封装。TSOP内存是在芯片的周围做出引脚，采用SMT技术（表面安装技术）附着在PCB板的表面，装配高度不到1.27mm。具体到FLASH这类型芯，工艺主要是把FLASH晶圆固定在钢板框架上，然后通过打线把晶圆上的点连接到框架的PIN脚上，再对表面进行注胶。\n目前的最高的封闭技术能把四颗晶圆封闭在一个TSOP的FLASH内。此种TSOP封装的FLASH相对较厚。TSOP特点：电流大幅度变化时，引起输出电压较小，适合高频应用，操作比较方便（如方便手工贴片或拆片及反复利用），可靠性也比较高。同时TSOP封装具有成品率高。价格相对COB高，因此得到了极为广泛的应用。\n2、COB封装\nCOB(chip on board) 板上芯片封装，是裸芯片贴装技术之一。半导体芯片交接贴装在印刷线路板上，芯片与PCB板是通过邦定连接的方法实现。NAND FLASH行业使用COB的封装方式主要是节省成本考虑。工程师先把外围电气走线画好，然后在PCB板上点红胶，把晶圆按指定方向及位置贴好。\n然后使用邦定机对晶圆进行邦定。确认邦定电气性能良好后，对晶圆表面及PCB板部分进行树脂覆盖固定。COB 是最简单的裸芯片贴装技术，但它的封装密度远不如TSOP和BGA技术。\n3、BGA封装\nBGA(ball grid array) 球形触点陈列，表面贴装型封装之一。在印刷基板的背面按陈列方式制作出球形凸点用以 代替引脚，在印刷基板的正面装配NANDflash 芯片，然后用模压树脂或灌封方法进行密封。封装本体也可做的比QFP(四侧引脚扁平封装)小。\nBGA主要特点：1、I/O引脚数虽然增多，但引脚之间的距离远大于QFP封装方式，提高了成品率 2、虽然BGA的功耗增加，但由于采用的是可控塌陷芯片法焊接，从而可以改善电热性能 3、信号传输延迟小，适应频率大大提高 4、组装可用共面焊接，可靠性大大提高。此封闭应用在NAND FLASH方面，主要影响是：1、可针对一些大尺寸晶圆进行封装。2、减小NAND flash封装片的面积，适用于对于主板尺寸要求严格的产品，特别是近些年来的可穿戴设备，对于产品尺寸的要求相当严格。3、此封闭大部分为原装片使用。黑片相对较少使用BGA。\nFTL简介 FTL是Flash Translation Layer(闪存转换层)的缩写，\n完成主机(或者用户，Host)逻辑地址空间到闪存(Flash)物理地址空间的翻译(Translation),或者说映射(Mapping)。SSD每把一笔用户逻辑数据写人闪存地址空间，便记录下该逻辑地址到物理地址的映射关系。当主机想读取该数据时，SSD便会根据这个映射，从闪存读取这笔数据然后返回给用户。\n基本功能 完成逻辑地址空间到物理地址空间的映射。\n闪存的特性：\n（1） 闪存块（Block）不能覆盖写，需要维护一张逻辑地址到物理地址的映射表，FTL需要做垃圾回 收，即使GC (Garbage Collection, 垃圾回收)\n（2） 闪存块有一定寿命，FTL需要做Wear Leveling,让数据写入均摊到每个闪存块上，即让每个块磨损都差不多，从而保证SSD具有最大的数据写入量。\n（3） 闪存块读的次数有限，次数过多会有读干扰（具体见第三章），FTL需要处理读干扰问题，当某个闪存块读的次数将要达到一定阈值时，FTL需要把这些数据从该闪存块上搬走，从而避免数据出错。\n（4） 数据的保存问题，必须上电，FTL才有效，好的FTL，就需要有处理数据保持问题的能力。\n（5） 坏块问题，FTL管理坏块。\n（6） 对MLC或TLC来说，存在Lower Page corruption的问题。即掉电异常问题。好的FTL，应该有机制避免这个问题。\n（7） MLC或TLC的读写速度都不如SLC,但它们都可以配成SLC模式来使用。好的FTL，会利用该特性去改善SSD的性能和可靠性。\n映射管理 分类：\n（1）块映射：块映射有好的连续大尺寸的读写性能，但小尺寸数据的写性能是非常糟糕的。\n（2）页映射：闪存页远比闪存块多，因此需要更多的空间来存储映射表。但它的性能更好，尤其体现在随机写上面。为追求性能，SSD一般都采用页映射。\n（3）混合映射：块内采用页映射的方式。\n映射表大小=SSD大小/逻辑页大小\r（准确来说，映射表大小是SSD容量大小的1/1024。前提条件是:映射页大小为4KB,物理地址用4Byte表示。）.\n映射表存储在DRAM中，\nHMD ( Host Memory Buffer，主机高速缓冲存储器)：主机在内存中专门划出一部分空间给SSD用，SSD可以把它当成自己的DRAM 使用。因此，映射表完全可以放到主机端的内存中去。\n垃圾回收 垃圾回收就是把某个闪存块上的有效数据读出来，重写，然后把该闪存块擦除，就得到新的可用闪存块了。\n随机存取时候，如何挑选要回收的内存块，挑垃圾比较多的闪存块来回收，因为有效数据少，要搬移的数据少，这样腾出空闪存块的速度快。\n写放大（WA） 写放大越大，意味着额外写人闪存的数据越多，一方面磨损闪存，减少SSD寿命，另一方面，写人这些额外数据会占用底层闪存带宽，影响SSD性能。\n解决方法：\n顺序写（不可控）\n增大OP（预留空间）（可控）\nOP越大，写放大越小：（很好理解，OP越大，每个闪存块有效数据越少，垃圾越多，因此需要重写更少的数据，因此写放大越小。同时，由于GC需要重写的数据越少，SSD满盘写性能也越好。）\n垃圾回收可以简单地分为三步 1 )挑选源闪存块。（BPA算法）\n2 )从源闪存块中找有效数据。\n3)把有效数据写人到目标闪存块。\n垃圾回收时机 （1）当用户写人数据时，如果可用的闪存块小于一定阈值，这时就需要做GC，以腾出空间给用户写。这时做的GC，叫作Foreground GC (前台垃圾回收)。(被动)\n（2）Background GC (后台垃圾回收)，它是在SSD空闲(Idle)的时候，SSD主动去做的GC，这样在用户写人的时候就有充裕的可用闪存块，不需要临时抱佛脚(做Foreground GC)，从而改善用户写人性能。但是，出于功耗考虑，有些SSD可能就不做后台垃圾回收了，当SSD空闲后，直接进入省电模式，或者做少量的GC，然后进人省电模式。（主动）\nTrim（移除）：新增的ATA命令(Data Set Management)， 专为SSD而生\n在没有Trim之前，SSD无法知道那些被删除的数据页是否无效，必须等到系统要求在相同的地方(用户空间、逻辑空间)写人数据时才知道那些数据是无效的，进而放心删除。\n一般FTL都有这3个表：\n（1）FTL映射表记录每个LBA对应的物理页位置；\n（2）Valid Page Bit Map (VPBM)记录每个物理块上哪个页有有效数据；\n（3）Valid Page Count (VPC)则记录每个物理块上的有效页个数。\n通常GC会使用VPC进行排序来回收最少有效页的闪存块; VPBM则是为了在GC时只读有用的数据，也有部分FTL会省略这个表。\nSSD收到Trim命令后，为了实现数据删除，固件要按顺序做以下的事情：\n5~7是Trim命令处理后，GC的处理，不是Trim命令处理的部分。Trim命令不触发GC。\n磨损平衡 磨损平衡，就是让SSD中的每个闪存块的磨损(擦除)都保持均衡。\n冷数据(Cold Data)： 不经常更新的块\n热数据(Hot Data)： 更新频繁的数据\n年老的(Old)块： 擦写次数较多的块\n年轻的(Young)块： 擦写次数较少的块 EC（擦除次数）\nSSD一般有动态磨损平衡(Dynamic WL)和静态磨损平衡(Static WL)两种算法。\n动态磨损平衡算法的基本思想是把热数据写到年轻的块上，即在拿一个新的闪存块用来写的时候，挑选擦写次数小的;\n静态磨损平衡算法基本思想是把冷数据写到年老的块上，即把冷数据搬到擦写次数比较多的闪存块上。\n掉电恢复 正常掉电：\n异常掉电：\n为防止异常掉电导致的数据丢失，一个简单的设计就是在SSD上加电容，SSD一旦检测到掉电，就让电容开始放电，然后把RAM中的数据刷到闪存上面去，从而避免数据丢失。\r重构 SSD在把用户数据写到闪存的时候，会额外打包一些数据，我们叫它元数据，(Meta Data)\n映射表恢复原理：\n只要全盘扫描整个闪存空间，就能获得所有的映射关系，最终完成整个映射表的重构。（time过长）\n坏块管理 坏块主要来源于：\n1、出厂坏块（Factory Bad Block）\r2、增长坏块（Grown Bad Block）\r坏块管理策略：\n一是略过(Skip) 策略，\n二是替换(Replace)策略。（用户空间与预留空间）采用替换策略，SSD内部需维护一张重映射表(Remap Table) ;\nSLC Cache SLC相对MLC和TLC来说，有更好的读写性能和更长的寿命。这里所说的SLC Cache是把MLC或者TLC里面的一些闪存块配置成SLC模式来访问。\n优点：\n（1） 性能考虑\n（2） 防止Lower Page数据被带坏\n（3） 解决闪存的缺陷\n（4） 更多的数据写入量\n强制写人策略能保护Lower Page数据，而后者不能。非强制SLC写入策略，具有更好的后期写入性能。\nRD\u0026amp;DR RD指的是Read Disturb（读打扰），DR指的是Data Retention（数据保留）。 两者都能导致数据丢失，但原理和固件处理方式都不一样。\nHost Based FTL：\nDevice Based存在以下缺点:\n（1）FTL架构通用，不能针对具体应用做定制化。\n（2）控制器芯片功能复杂，设计难度大，研发成本高。\n（3）闪存更新很快，一般每年闪存厂商都会推出新一代产品，有新的使用特性，需要控制器芯片做出修改，但是芯片改版成本很高。\n（4）企业级应用需要高性能、大容量，通用控制器芯片支持的最大性能和容量有限制。\n（5）企业级市场需求多种多样，有些需求需要控制器提供特殊功能支持，这些是通用SSD主控芯片无法提供的。\nHost Based FTL架构 Host Based SSD一般的模式是把闪存的读写接口直接开放给驱动程序，这样驱动程序就能自行管理闪存内部资源。控制器大都采用可编程逻辑器件FPGA，功能比较简单，主要实现ECC纠错和闪存时序控制。如图所示，主机驱动直接管理闪存阵列，控制器只是起到ECC纠错算法和物理协议转换的作用。\n","date":"2024-08-04T00:00:00Z","image":"https://tflasp.fun/2024/intossd/ssd_hu9e606eafa84da1a4e5c2a51c6c293ee0_2842596_120x120_fill_q75_box_smart1.jpg","permalink":"https://tflasp.fun/2024/intossd/","title":"年度巨献 | 深入浅出SSD（持续更新）"},{"content":"前言 该文章还在CSDN发表，文章链接：Link\nPVE镜像下载 1、在浏览器输入以下网址下载pve的iso安装镜像。 Download Proxmox VE 清华大学开源镜像站，下拉选择对应版本下载iso文件。\n2、制作系统引导盘\n这里使用rufus工具将ISO文件刻录进U盘\nRufus下载地址 （密码:5k8t）\n下载完成后直接双击运行，无需安装，设备中选择U盘，引导类型选择PVE镜像，然后点击开始，注意U盘中的原有数据会被格式化，重要数据记得备份。\nRufus 注意:一定要使用DD模式写入！使用iso模式写入可能导致某些版本的镜像无法启动！\n当写盘完成时，显示准备就绪，即可关闭程序，弹出U盘，拔出U盘。\nPVE 安装 1、打开主机电源，不断按键盘F12按键（不同主机的启动按键不同，请自行百度）选择由刚刚制作好的启动盘启动。\n2、进入PVE安装页面，选择第一个Install Proxmox VE （Graphical)，按回车。\n然后会进入一段代码，此时不要作任何操作。\n3、进入下面页面安装正式开始，首先使用协议页面点击我同意。\n填写邮件，网卡选默认即可。\nGateway是虚拟机网关，一般默认即可，然后点下一步设定密码。\n这一步后就等待安装，安装完毕后重启记得拔掉u盘。\n重启\n进入到这个界面是代表安装成功了。\n初始化PVE 接下来到主力机上进行操作，输入刚刚安装成功显示的网址（如前一个图，网址为192.168.10.20:8006）\n注意输入时要带端口号，不然进不去。\n继续访问，进入pve登录界面。\n输入刚刚设置的密码，改为中文（非必须）即可进入pve，第一次登陆会显示无有效订阅，关闭即可。\n虚拟机直通设备 首先在主板BIOS里查看是否开启了硬件虚拟化（通常在Advanced栏下），同时CPU也必须要支持虚拟化才行。Intel VT-D。\n如上图进入pve shell。\n输入\nnano /etc/default/grub\r对于Intel CPU，添加 intel_iommu=on，操作如下： 2、找到：GRUB_CMDLINE_LINUX_DEFAULT=\u0026ldquo;quiet\u0026rdquo;\n然后修改为\nGRUB_CMDLINE_LINUX_DEFAULT=\u0026quot;quiet intel_iommu=on\u0026quot;\r编辑完成后，使用快捷键 Ctrl + O 回车保存文件，Ctrl + X 退出编辑器。\n3、使用命令 update-grub 保存更改并更新grub\nroot@pve:~# update-grub\r4、更新完成后，使用命令 reboot 重启PVE系统\nroot@pve:~# reboot\r从命令行运行\ndmesg | grep -e DMAR -e IOMMU\r如果没有输出，则说明有问题。\n如果有,可基本确认这个过程顺利完成! 接下来就可以为虚拟机正常的添加硬件直通了。\n对于AMD CPU 对于AMD CPU 添加 amd_iommu=on, 操作如下：\n1、Shell 里面输入命令：nano /etc/default/grub\nroot@pve:~# nano /etc/default/grub\r2、在里面找到：GRUB_CMDLINE_LINUX_DEFAULT=\u0026ldquo;quiet\u0026rdquo;\n然后修改为\nGRUB_CMDLINE_LINUX_DEFAULT=\u0026quot;quiet amd_iommu=on\u0026quot;\r编辑完成后，使用快捷键 Ctrl + O 回车保存文件，Ctrl + X 退出编辑器。\n3、使用命令 update-grub 保存更改并更新grub\nroot@pve:~# update-grub\r4、更新完成后，使用命令 reboot 重启PVE系统\nroot@pve:~# reboot\r这样虚拟机直通设置就完成了。\n当然，也可以使用pvetools来进行pve环境下的优化设置操作，更加方便（需换源）\n虚拟机安装 pve安装虚拟机还是非常简单的，本篇我们将使用pve安装win10来演示一下安装过程，其他系统安装大同小异。\n1、首先需要上传安装镜像，通过local(pve)→ISO镜像→上传，将win10镜像上传到pve中。\n2、回到pve首页，点击右上角的创建虚拟机，常规中自定义虚拟机的名称\n3、操作系统中选择windows10镜像，然后在类型中选择安装操作系统的类型，注意版本也要选择。\n4、系统保持默认即可。\n5、硬盘中总线选择sata，其他保持默认。（当然SCSI、IDE等等都行的）\n6、CPU根据机器配置选择，插槽表示cpu个数单CPU机器输入1，核心根据CPU选择，类别使用HOST系统性能最大化。\n7、内存根据机器配置以及具体需求设置。\n8、网络设置中选择兼容性最高的e1000即可。\n9、最后检查配置没有，确认无误后点击完成。\n10、稍等几秒，机器创建成功。\n11、点击控制台启动，按照正常windows系统安装流程安装即可。\n","date":"2024-07-15T00:00:00Z","image":"https://tflasp.fun/2024/pveinstall/pveinstaller_hufe9653886b00745c7725dbc66e171966_53939_120x120_fill_box_smart1_3.png","permalink":"https://tflasp.fun/2024/pveinstall/","title":"【归档】PVE 8 安装与优化"},{"content":"Github仓库地址：hugo-stack-theme\n使用方式 从零建立博客：Fork仓库到自己账号下，用Github 注册 Vercel，依次点击Overview → New Project → import刚刚Fork的仓库，设置FRAMEWORK PRESET为Hugo → 点击Environment Variables，设置NAME为HUGO_VERSION，Value为Hugo版本号（如0.89.0） → 点击Add → 点击Deploy，稍等十来秒即可部署完成。下载仓库到本地后使用Github Desktop更新文章。（注，本地预览需安装Hugo，Powershell里输入Choco install hugo-extended）\n友情链接使用方式 友链头像放在/assets/link-img，友链数据放在/data/links.json\n[\r{\r\u0026quot;title\u0026quot;: \u0026quot;Friends\u0026quot;,\r\u0026quot;website\u0026quot;: \u0026quot;https://mantyke.icu/\u0026quot;,\r\u0026quot;image\u0026quot;: \u0026quot;mantyke.png\u0026quot;,\r\u0026quot;description\u0026quot;: \u0026quot;Description\u0026quot;\r},\r{\r\u0026quot;title\u0026quot;: \u0026quot;友情链接2\u0026quot;,\r\u0026quot;website\u0026quot;: \u0026quot;\u0026quot;,\r\u0026quot;image\u0026quot;: \u0026quot;\u0026quot;,\r\u0026quot;description\u0026quot;: \u0026quot;\u0026quot;\r}\r]\r修改页尾信息 站点名称及建站时间请修改以下代码\n站点名称及链接：\n#位置：layout/partials/footer/footer.html\r\u0026lt;section class=\u0026quot;copyright\u0026quot;\u0026gt;\r\u0026amp;copy; {{ if and (.Site.Params.footer.since) (ne .Site.Params.footer.since (int (now.Format \u0026quot;2006\u0026quot;))) }}\r{{ .Site.Params.footer.since }} - {{ end }}\r{{ now.Format \u0026quot;2006\u0026quot; }} \u0026lt;a href=\u0026quot;https://stack-theme-mod.vercel.app/\u0026quot;\u0026gt;Example Site\u0026lt;/a\u0026gt;·\u0026lt;i class=\u0026quot;fas fa-bell\u0026quot;\u0026gt;\u0026lt;/i\u0026gt; \u0026lt;a id=\u0026quot;days\u0026quot;\u0026gt;0\u0026lt;/a\u0026gt;Days\u0026lt;br\u0026gt;\r{{$var := $scratch.Get \u0026quot;total\u0026quot;}}{{$var = div $var 100.0}}{{$var = math.Ceil $var}}{{$var = div $var 10.0}}共书写了{{$var}}k字·共 {{ len (where .Site.RegularPages \u0026quot;Section\u0026quot; \u0026quot;post\u0026quot;) }}篇文章\u0026lt;/br\u0026gt;\u0026lt;span\u0026gt;\u0026lt;p\u0026gt;\r\u0026lt;/section\u0026gt;\r#位置：layout/partials/footer/footer.html\rvar s1 = '2022-02-13';//设置为建站时间\rs1 = new Date(s1.replace(/-/g, \u0026quot;/\u0026quot;));\rs2 = new Date();\rvar days = s2.getTime() - s1.getTime();\rvar number_of_days = parseInt(days / (1000 * 60 * 60 * 24));\rdocument.getElementById('days').innerHTML = number_of_days;\r其他常见修改 设置博客头像 位置：/assets/img，请将头像命名为avatar.png，替换原头像文件\n删除博客头像 位置：/layouts/partials/sidebar/left.html，注释或删去以下部分：\n{{ with .Site.Params.sidebar.avatar }}\r{{ if (default true .enabled) }}\r\u0026lt;figure class=\u0026quot;site-avatar\u0026quot;\u0026gt;\r\u0026lt;a href=\u0026quot;{{ .Site.BaseURL | relLangURL }}\u0026quot;\u0026gt;\r{{ if not .local }}\r\u0026lt;img src=\u0026quot;{{ .src }}\u0026quot; width=\u0026quot;300\u0026quot; height=\u0026quot;300\u0026quot; class=\u0026quot;site-logo\u0026quot; loading=\u0026quot;lazy\u0026quot; alt=\u0026quot;Avatar\u0026quot;\u0026gt;\r{{ else }}\r{{ $avatar := resources.Get (.src) }}\r{{ if $avatar }}\r{{ $avatarResized := $avatar.Resize \u0026quot;300x\u0026quot; }}\r\u0026lt;img src=\u0026quot;{{ $avatarResized.RelPermalink }}\u0026quot; width=\u0026quot;{{ $avatarResized.Width }}\u0026quot;\rheight=\u0026quot;{{ $avatarResized.Height }}\u0026quot; class=\u0026quot;site-logo\u0026quot; loading=\u0026quot;lazy\u0026quot; alt=\u0026quot;Avatar\u0026quot;\u0026gt;\r{{ else }}\r{{ errorf \u0026quot;Failed loading avatar from %q\u0026quot; . }}\r{{ end }}\r{{ end }}\r\u0026lt;/a\u0026gt;\r{{ with $.Site.Params.sidebar.emoji }}\r\u0026lt;span class=\u0026quot;emoji\u0026quot;\u0026gt;{{ . }}\u0026lt;/span\u0026gt;\r{{ end }}\r\u0026lt;/figure\u0026gt;\r{{ end }}\r{{ end }}\r修改博客背景颜色 位置：assets\\scss\\variables.scss\n--body-background: #f6f6f6;\r指定首页分类标签颜色 位置：content\\categories，创建分类同名文件夹后，在文件夹内创建_index.md文件，写入frontmatter\ntitle: \u0026quot;class\u0026quot; //分类名称\rdescription: \u0026quot;简介\u0026quot; //简介\rimage: \u0026quot;image.png\u0026quot; //分类题图\rstyle:\rbackground: \u0026quot;#80aba9\u0026quot; //分类标签底色\rcolor: \u0026quot;#fff\u0026quot;\r---\r配置各类图标 图标放在：/assets/icons，svg格式。\n","date":"2024-07-11T00:00:00Z","image":"https://tflasp.fun/2024/hugo-stack/hugo_hu31aa5058717a0204c0e7857d42dce0eb_44097_120x120_fill_q75_box_smart1.jpg","permalink":"https://tflasp.fun/2024/hugo-stack/","title":"【归档】Hugo | 使用Hugo+Stack主题搭建博客"},{"content":"​\n所需工具：【office安装工具】Office Tool Plus(OTP),[Windows desktop runtime x 86]，一台联网计算机\n本文章所提及的所有文件：OTP,Windows desktop runtime，我已经上传到主页，可以自行下载体验！，支持正版，请到此处购买正版Office\n一：安装Office 365\n首先安装Windows desktop runtime X86\n然后双击运行OTP，同意许可条款\n点击部署，添加产品\n选择365 应用企业版，在右侧选择你的体系结构，通道建议选择测试通道，这样Office就有了新的启动UI~\n点击开始部署，然后保持你的联机状态，office会自动下载并安装，安装完成后会有一个通知（下载安装速度取决于你的网速和RAM大小），安装完成后关闭红色的office部署工具，再次进入OTP，点击左上角的返回回到主页\n**二：激活 **\n在主页里找到“激活”，进入后安装许可证：“Office mondo 2016-批量许可证”，点击安装许可证。\n在上方有一个类似于命令提示符的图标，打开输入以下指令：\n/osppilbyid MondoVolume /osppsethst:kms.loli.beer /osppsetprt:1688 /osppact\r按回车，右下角会有“OSPP正在运行”，等待完成，Office就激活了，激活是有一定时效的，一般是180天，激活失效后再OTP里-激活-清除许可证，然后再复制命令粘贴到命令行里就能再次激活了。\n三：使用\n本文章所提及的所有文件：OTP,Windows desktop runtime，我已经上传到主页，可以自行下载，支持正版！\n","date":"2021-10-10T00:00:00Z","image":"https://tflasp.fun/2021/officeinstall/office1_huef74ab535c7b344634e4ad90e98a5055_85467_120x120_fill_q75_box_smart1.jpg","permalink":"https://tflasp.fun/2021/officeinstall/","title":"安装与激活Microsoft Office"},{"content":"This article offers a sample of basic Markdown syntax that can be used in Hugo content files, also it shows whether basic HTML elements are decorated with CSS in a Hugo theme.\nHeadings The following HTML \u0026lt;h1\u0026gt;—\u0026lt;h6\u0026gt; elements represent six levels of section headings. \u0026lt;h1\u0026gt; is the highest section level while \u0026lt;h6\u0026gt; is the lowest.\nH1 H2 H3 H4 H5 H6 Paragraph Xerum, quo qui aut unt expliquam qui dolut labo. Aque venitatiusda cum, voluptionse latur sitiae dolessi aut parist aut dollo enim qui voluptate ma dolestendit peritin re plis aut quas inctum laceat est volestemque commosa as cus endigna tectur, offic to cor sequas etum rerum idem sintibus eiur? Quianimin porecus evelectur, cum que nis nust voloribus ratem aut omnimi, sitatur? Quiatem. Nam, omnis sum am facea corem alique molestrunt et eos evelece arcillit ut aut eos eos nus, sin conecerem erum fuga. Ri oditatquam, ad quibus unda veliamenimin cusam et facea ipsamus es exerum sitate dolores editium rerore eost, temped molorro ratiae volorro te reribus dolorer sperchicium faceata tiustia prat.\nItatur? Quiatae cullecum rem ent aut odis in re eossequodi nonsequ idebis ne sapicia is sinveli squiatum, core et que aut hariosam ex eat.\nBlockquotes The blockquote element represents content that is quoted from another source, optionally with a citation which must be within a footer or cite element, and optionally with in-line changes such as annotations and abbreviations.\nBlockquote without attribution Tiam, ad mint andaepu dandae nostion secatur sequo quae. Note that you can use Markdown syntax within a blockquote.\nBlockquote with attribution Don\u0026rsquo;t communicate by sharing memory, share memory by communicating.\n— Rob Pike1\nTables Tables aren\u0026rsquo;t part of the core Markdown spec, but Hugo supports supports them out-of-the-box.\nName Age Bob 27 Alice 23 Inline Markdown within tables Italics Bold Code italics bold code A B C D E F Lorem ipsum dolor sit amet, consectetur adipiscing elit. Phasellus ultricies, sapien non euismod aliquam, dui ligula tincidunt odio, at accumsan nulla sapien eget ex. Proin eleifend dictum ipsum, non euismod ipsum pulvinar et. Vivamus sollicitudin, quam in pulvinar aliquam, metus elit pretium purus Proin sit amet velit nec enim imperdiet vehicula. Ut bibendum vestibulum quam, eu egestas turpis gravida nec Sed scelerisque nec turpis vel viverra. Vivamus vitae pretium sapien Code Blocks Code block with backticks \u0026lt;!doctype html\u0026gt;\r\u0026lt;html lang=\u0026quot;en\u0026quot;\u0026gt;\r\u0026lt;head\u0026gt;\r\u0026lt;meta charset=\u0026quot;utf-8\u0026quot;\u0026gt;\r\u0026lt;title\u0026gt;Example HTML5 Document\u0026lt;/title\u0026gt;\r\u0026lt;/head\u0026gt;\r\u0026lt;body\u0026gt;\r\u0026lt;p\u0026gt;Test\u0026lt;/p\u0026gt;\r\u0026lt;/body\u0026gt;\r\u0026lt;/html\u0026gt;\rCode block indented with four spaces \u0026lt;!doctype html\u0026gt;\r\u0026lt;html lang=\u0026quot;en\u0026quot;\u0026gt;\r\u0026lt;head\u0026gt;\r\u0026lt;meta charset=\u0026quot;utf-8\u0026quot;\u0026gt;\r\u0026lt;title\u0026gt;Example HTML5 Document\u0026lt;/title\u0026gt;\r\u0026lt;/head\u0026gt;\r\u0026lt;body\u0026gt;\r\u0026lt;p\u0026gt;Test\u0026lt;/p\u0026gt;\r\u0026lt;/body\u0026gt;\r\u0026lt;/html\u0026gt;\rCode block with Hugo\u0026rsquo;s internal highlight shortcode 1 2 3 4 5 6 7 8 9 10 \u0026lt;!doctype html\u0026gt; \u0026lt;html lang=\u0026#34;en\u0026#34;\u0026gt; \u0026lt;head\u0026gt; \u0026lt;meta charset=\u0026#34;utf-8\u0026#34;\u0026gt; \u0026lt;title\u0026gt;Example HTML5 Document\u0026lt;/title\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;p\u0026gt;Test\u0026lt;/p\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; Diff code block [dependencies.bevy]\rgit = \u0026quot;https://github.com/bevyengine/bevy\u0026quot;\rrev = \u0026quot;11f52b8c72fc3a568e8bb4a4cd1f3eb025ac2e13\u0026quot;\r- features = [\u0026quot;dynamic\u0026quot;]\r+ features = [\u0026quot;jpeg\u0026quot;, \u0026quot;dynamic\u0026quot;]\rList Types Ordered List First item Second item Third item Unordered List List item Another item And another item Nested list Fruit Apple Orange Banana Dairy Milk Cheese Other Elements — abbr, sub, sup, kbd, mark GIF is a bitmap image format.\nH2O\nXn + Yn = Zn\nPress CTRL+ALT+Delete to end the session.\nMost salamanders are nocturnal, and hunt for insects, worms, and other small creatures.\nHyperlinked image Google The above quote is excerpted from Rob Pike\u0026rsquo;s talk during Gopherfest, November 18, 2015.\u0026#160;\u0026#x21a9;\u0026#xfe0e;\n","date":"2020-01-01T00:00:00Z","image":"https://tflasp.fun/2020/markdown-syntax-guide/pawel-czerwinski-8uZPynIu-rQ-unsplash_hu1635d8cd9fc5c457cec96cd45d6aa52e_16493_120x120_fill_q75_box_smart1.jpg","permalink":"https://tflasp.fun/2020/markdown-syntax-guide/","title":"Markdown Syntax Guide"},{"content":"Mathematical notation in a Hugo project can be enabled by using third party JavaScript libraries.\nIn this example we will be using KaTeX\nCreate a partial under /layouts/partials/math.html Within this partial reference the Auto-render Extension or host these scripts locally. Include the partial in your templates like so: {{ if or .Params.math .Site.Params.math }}\r{{ partial \u0026quot;math.html\u0026quot; . }}\r{{ end }}\rTo enable KaTex globally set the parameter math to true in a project\u0026rsquo;s configuration To enable KaTex on a per page basis include the parameter math: true in content files Note: Use the online reference of Supported TeX Functions\nExamples Block math: $$ \\varphi = 1+\\frac{1} {1+\\frac{1} {1+\\frac{1} {1+\\cdots} } } $$\n","date":"2020-01-01T00:00:00Z","permalink":"https://tflasp.fun/2020/math-typesetting/","title":"Math Typesetting"}]